
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
  
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Learn how to create cross-chain token transfers using Wormhole's Solidity SDK. Build and deploy smart contracts to send tokens from one blockchain to another.">
      
      
      
        <link rel="canonical" href="https://docs.wormhole.com/tutorials/messaging/cross-chain-token-contracts/">
      
      
        <link rel="prev" href="../cross-chain-contracts/">
      
      
        <link rel="next" href="../../../learn/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.webp">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.24">
    
  

    <title>Cross-Chain Token Transfers | Wormhole Docs</title>
    
	
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M11.013 1.427a1.75 1.75 0 0 1 2.474 0l1.086 1.086a1.75 1.75 0 0 1 0 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 0 1-.927-.928l.929-3.25c.081-.286.235-.547.445-.758l8.61-8.61Zm.176 4.823L9.75 4.81l-6.286 6.287a.253.253 0 0 0-.064.108l-.558 1.953 1.953-.558a.253.253 0 0 0 .108-.064Zm1.238-3.763a.25.25 0 0 0-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 0 0 0-.354Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');}</style>



    
  <link rel="stylesheet" href="../../../assets/stylesheets/wormhole.css">

    
  
      
    
  <link rel="preconnect" href="https://widget.kapa.ai/">
  <style data-emotion="mantine" data-s=""></style>
  <script defer
    src="https://widget.kapa.ai/kapa-widget.bundle.js"
    data-website-id="a5f481b8-5f4f-43fc-b6bd-11169bac7271"
    data-project-name="Wormhole"
    data-project-color="rgb(75, 75, 75)"
    data-button-box-shadow="0 0 10px rgba(255, 255, 255, 0.2)"
    data-project-logo="../../../assets/images/logo-for-kapa.webp"
    data-font-family="Roboto"
    data-footer-tos-privacy-links='[{"title": "terms of service", "url": "https://wormhole.com/pages/terms-of-use"}, {"title": "privacy policy", "url": "https://wormhole.com/pages/data-protection-and-privacy-policy"}]'
  ></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/terminal.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-SGJJFZS9BB"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-SGJJFZS9BB",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-SGJJFZS9BB",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cross-chain-token-transfers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      
  
    
  
  <header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="Header">
      <label class="md-header__button md-icon" for="__drawer">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
      </label>
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <a href="../../.." title="Wormhole Docs" class="md-header__button md-logo" aria-label="Wormhole Docs" data-md-component="logo">
            
  <img src="../../../assets/images/wormhole.webp" alt="logo">

          </a>
        </div>
      </div>
      <div class="md-header__buttons">
        
          
            <nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
    <div class="md-grid">
      <ul class="md-tabs__list">
        
          
        
          
            <li class="md-tabs__item--custom" tabindex="0">    
              <span class="md-tabs__link">Build <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6 1.41-1.42Z"/></svg></span>
              <ul class="md-tab__list">
                
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../build/start-building/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/start-building.svg" alt="Start Building" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Start Building</span>
                        </div>
                      </a>
                    </li>
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../build/applications/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/applications.svg" alt="Build Frontend Applications" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Build Frontend Applications</span>
                        </div>
                      </a>
                    </li>
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../build/contract-integrations/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/contract-integrations.svg" alt="Build Contract Integrations" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Build Contract Integrations</span>
                        </div>
                      </a>
                    </li>
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../build/toolkit/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/toolkit.svg" alt="Toolkit" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Toolkit</span>
                        </div>
                      </a>
                    </li>
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../build/reference/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/reference.svg" alt="Reference" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Reference</span>
                        </div>
                      </a>
                    </li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="md-tabs__item--custom" tabindex="0">    
              <span class="md-tabs__link">Infrastructure <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6 1.41-1.42Z"/></svg></span>
              <ul class="md-tab__list">
                
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../infrastructure/relayers/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/relayers.svg" alt="Relayers" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Relayers</span>
                        </div>
                      </a>
                    </li>
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../infrastructure/spy/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/spy.svg" alt="Spy" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Spy</span>
                        </div>
                      </a>
                    </li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="md-tabs__item--custom" tabindex="0">    
              <span class="md-tabs__link">Tutorials <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6 1.41-1.42Z"/></svg></span>
              <ul class="md-tab__list">
                
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/messaging.svg" alt="Messaging" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Messaging</span>
                        </div>
                      </a>
                    </li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="md-tabs__item--custom" tabindex="0">    
              <span class="md-tabs__link">Learn <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6 1.41-1.42Z"/></svg></span>
              <ul class="md-tab__list">
                
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../learn/fundamentals/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/fundamentals.svg" alt="Fundamentals" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Fundamentals</span>
                        </div>
                      </a>
                    </li>
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../learn/infrastructure/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/infrastructure.svg" alt="Infrastructure Components" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Infrastructure Components</span>
                        </div>
                      </a>
                    </li>
                  
                
                  
                    <li class="md-tab__item">
                      <a href="../../../learn/messaging/">
                        <div class="icon-col">
                          
                          <img class="dropdown-icon" src="/assets/images/dropdown-icons/messaging.svg" alt="Messaging" loading="lazy">
                        </div>
                        <div class="text-col">
                          <span class="dropdown-title">Messaging</span>
                        </div>
                      </a>
                    </li>
                  
                
              </ul>
            </li>
          
        
      </ul>
    </div>
  </nav>
            
              <label class="search" for="__search">
                <span>
                  
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
                  Search
                </span>
              </label>
              <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input
        type="text"
        class="md-search__input"
        name="query"
        aria-label="Search"
        autocapitalize="off"
        autocorrect="off"
        autocomplete="off"
        spellcheck="false"
        data-md-component="search-query"
        required
      />
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button
          type="reset"
          class="md-search__icon md-icon"
          title="Clear"
          aria-label="Clear"
          tabindex="-1"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        
        
        

        
      </div>
    </nav>
  </header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Wormhole Docs" class="md-nav__button md-logo" aria-label="Wormhole Docs" data-md-component="logo">
      
  <img src="../../../assets/images/wormhole.webp" alt="logo">

    </a>
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      
  
    
    
    
      <li class="md-nav__item">
        <a href="../../.." class="md-nav__link">
          Home
        </a>
      </li>
    
  
    
      
      
      
  
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/">Build</a>
            
              <label for="__nav_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Build
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/start-building/">Start Building</a>
            
              <label for="__nav_2_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Start Building
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-start-building-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/start-building/supported-networks/">Supported Networks</a>
            
              <label for="__nav_2_2_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Supported Networks
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-start-building-supported-networks-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/evm/" class="md-nav__link">
          EVM
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/algorand/" class="md-nav__link">
          Algorand
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/aptos/" class="md-nav__link">
          Aptos
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_5" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/start-building/supported-networks/cosmos/">Cosmos</a>
            
              <label for="__nav_2_2_2_5">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_5">
            <span class="md-nav__icon md-icon"></span>
            Cosmos
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-start-building-supported-networks-cosmos-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/cosmos/cosmos/" class="md-nav__link">
          Cosmos
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/cosmos/gateway/" class="md-nav__link">
          Onboard to Cosmos Gateway
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/near/" class="md-nav__link">
          NEAR
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/solana/" class="md-nav__link">
          Solana
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/supported-networks/sui/" class="md-nav__link">
          Sui
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/testnet-faucets/" class="md-nav__link">
          TestNet Faucets
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/start-building/demos/" class="md-nav__link">
          Demos
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/applications/">Build Frontend Applications</a>
            
              <label for="__nav_2_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Build Frontend Applications
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-applications-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/wormhole-sdk/" class="md-nav__link">
          Wormhole SDK
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/applications/queries/">Queries</a>
            
              <label for="__nav_2_3_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Queries
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-applications-queries-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/queries/overview/" class="md-nav__link">
          Overview
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/queries/use-queries/" class="md-nav__link">
          Use Queries
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/queries/faqs/" class="md-nav__link">
          FAQs
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_4" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/applications/connect/">Connect</a>
            
              <label for="__nav_2_3_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_4">
            <span class="md-nav__icon md-icon"></span>
            Connect
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-applications-connect-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/connect/overview/" class="md-nav__link">
          Overview
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/connect/routes/" class="md-nav__link">
          Routes
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/connect/features/" class="md-nav__link">
          Features
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/applications/connect/configuration/" class="md-nav__link">
          Configuration
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/contract-integrations/">Build Contract Integrations</a>
            
              <label for="__nav_2_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Build Contract Integrations
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-contract-integrations-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/wormhole-relayers/" class="md-nav__link">
          Wormhole Relayer
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/core-contracts/" class="md-nav__link">
          Core Contracts
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/cctp/" class="md-nav__link">
          CCTP
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/gateway/" class="md-nav__link">
          Cosmos Gateway
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_6" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/contract-integrations/native-token-transfers/">Native Token Transfers</a>
            
              <label for="__nav_2_4_6">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_6">
            <span class="md-nav__icon md-icon"></span>
            Native Token Transfers
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-contract-integrations-native-token-transfers-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_6_2" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/contract-integrations/native-token-transfers/deployment-process/">Deployment Process</a>
            
              <label for="__nav_2_4_6_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_4_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_6_2">
            <span class="md-nav__icon md-icon"></span>
            Deployment Process
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-contract-integrations-native-token-transfers-deployment-process-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/native-token-transfers/deployment-process/installation/" class="md-nav__link">
          Installation
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/native-token-transfers/deployment-process/deploy-to-evm/" class="md-nav__link">
          Deploy to EVM
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/native-token-transfers/deployment-process/deploy-to-solana/" class="md-nav__link">
          Deploy to Solana
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/native-token-transfers/deployment-process/post-deployment/" class="md-nav__link">
          Post Deployment
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_6_3" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/contract-integrations/native-token-transfers/configuration/">NTT Configuration</a>
            
              <label for="__nav_2_4_6_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_4_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_6_3">
            <span class="md-nav__icon md-icon"></span>
            NTT Configuration
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-contract-integrations-native-token-transfers-configuration-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/native-token-transfers/configuration/rate-limiting/" class="md-nav__link">
          Rate Limiting
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/native-token-transfers/configuration/access-control/" class="md-nav__link">
          Access Control
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_7" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/contract-integrations/fast-transfers/">Fast Transfers</a>
            
              <label for="__nav_2_4_7">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_7">
            <span class="md-nav__icon md-icon"></span>
            Fast Transfers
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-contract-integrations-fast-transfers-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/fast-transfers/how-to-solver/" class="md-nav__link">
          How to Be a Solver
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/fast-transfers/smart-components/" class="md-nav__link">
          Smart Contract Components
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/contract-integrations/dev-env/" class="md-nav__link">
          Development Environment
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/toolkit/">Toolkit</a>
            
              <label for="__nav_2_5">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Toolkit
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-toolkit-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="https://wormholescan.io/" class="md-nav__link">
          Wormholescan
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/toolkit/cli/" class="md-nav__link">
          Wormhole CLI
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="/build/applications/wormhole-sdk/" class="md-nav__link">
          Wormhole SDK
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/toolkit/tilt/" class="md-nav__link">
          Tilt
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../build/reference/">Reference</a>
            
              <label for="__nav_2_6">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list build-reference-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/reference/chain-ids/" class="md-nav__link">
          Chain IDs
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/reference/contract-addresses/" class="md-nav__link">
          Contract Addresses
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../build/reference/consistency-levels/" class="md-nav__link">
          Consistency Levels
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
    
      
      
      
  
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../infrastructure/">Infrastructure</a>
            
              <label for="__nav_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list infrastructure-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
        
          
            
            
              
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../infrastructure/relayers/">Relayers</a>
            
              <label for="__nav_3_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Relayers
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list infrastructure-relayers-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../infrastructure/relayers/run-relayer/" class="md-nav__link">
          Run a Custom Relayer
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
        
          
            
            
              
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../infrastructure/spy/">Spy</a>
            
              <label for="__nav_3_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Spy
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list infrastructure-spy-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../infrastructure/spy/run-spy/" class="md-nav__link">
          Run a Spy
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
    
      
      
      
  
    
    
      
    
    
      
      <li class="md-nav__item md-nav__item--active md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
        
          
            
            
              
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../">Tutorials</a>
            
              <label for="__nav_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list tutorials-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
      
    
    
      
        
      
      <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
        
          
            
            
              
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../">Messaging</a>
            
              <label for="__nav_4_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Messaging
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list tutorials-messaging-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../cross-chain-contracts/" class="md-nav__link">
          Create Cross-Chain Contracts
        </a>
      </li>
    
  
              
            
              
                
    
    
      
    
    
      <li class="md-nav__item md-nav__item--active">
        
        <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
        
        
          
        
        
          <label class="md-nav__link md-nav__link--active" for="__toc">
            Create Cross-Chain Token Transfers
            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <div class="md-nav__link-wrapper md-nav__item md-nav__item--active">
          <a href="./" class="md-nav__link md-nav__link--active">
            Create Cross-Chain Token Transfers
          </a>
        </div>
        
          

  

<nav class="md-nav md-nav--secondary" aria-label="Sections">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Sections
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valid-tokens-for-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      Valid Tokens for Transfer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Project Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-cross-chain-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      Build Cross-Chain Contracts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build Cross-Chain Contracts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sender-contract-crosschainsender" class="md-nav__link">
    <span class="md-ellipsis">
      Sender Contract: CrossChainSender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiver-contract-crosschainreceiver" class="md-nav__link">
    <span class="md-ellipsis">
      Receiver Contract: CrossChainReceiver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the Contracts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-tokens-across-chains" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer Tokens Across Chains
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transfer Tokens Across Chains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-recap" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Recap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transfer-script" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transfer-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer Tokens
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
        
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
    
      
      
      
  
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../learn/">Learn</a>
            
              <label for="__nav_5">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Learn
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list learn-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../learn/fundamentals/">Fundamentals</a>
            
              <label for="__nav_5_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Fundamentals
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list learn-fundamentals-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/fundamentals/introduction/" class="md-nav__link">
          Introduction to Wormhole
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/fundamentals/security/" class="md-nav__link">
          Security
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/fundamentals/architecture/" class="md-nav__link">
          Architecture Overview
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/fundamentals/glossary/" class="md-nav__link">
          Glossary
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../learn/infrastructure/">Infrastructure Components</a>
            
              <label for="__nav_5_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure Components
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list learn-infrastructure-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/infrastructure/core-contracts/" class="md-nav__link">
          Core Contracts
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/infrastructure/vaas/" class="md-nav__link">
          VAAs
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/infrastructure/guardians/" class="md-nav__link">
          Guardians
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/infrastructure/spy/" class="md-nav__link">
          Spy
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/infrastructure/relayer/" class="md-nav__link">
          Relayers
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      
        
      
      <li class="md-nav__item md-nav__item--section md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../learn/messaging/">Messaging</a>
            
              <label for="__nav_5_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Messaging
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list learn-messaging-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/token-nft-bridge/" class="md-nav__link">
          Token Bridge
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/gateway/" class="md-nav__link">
          Cosmos Gateway
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/cctp/" class="md-nav__link">
          CCTP Bridge
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      
      <li class="md-nav__item md-nav__item--nested">
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_5" >
        
        
          
            
            
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
        
          
          
          <div class="md-nav__link md-nav__link--index ">
            <a href="../../../learn/messaging/native-token-transfers/">Native Token Transfers</a>
            
              <label for="__nav_5_4_5">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_5">
            <span class="md-nav__icon md-icon"></span>
            Native Token Transfers
          </label>
          <div class="nav-wrapper">
            
              
                <ul class="md-nav__list learn-messaging-native-token-transfers-" data-md-scrollfix>
              
            
            
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/native-token-transfers/overview/" class="md-nav__link">
          Overview
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/native-token-transfers/architecture/" class="md-nav__link">
          Architecture
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/native-token-transfers/deployment/" class="md-nav__link">
          Deployment Models
        </a>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/native-token-transfers/security/" class="md-nav__link">
          Security
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
              
                
    
    
    
      <li class="md-nav__item">
        <a href="../../../learn/messaging/fast-transfers/" class="md-nav__link">
          Fast Transfers
        </a>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
              
            
            </ul>
          </div>
        </nav>
      </li>
    
  
    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Sections">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Sections
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valid-tokens-for-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      Valid Tokens for Transfer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Project Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-cross-chain-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      Build Cross-Chain Contracts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build Cross-Chain Contracts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sender-contract-crosschainsender" class="md-nav__link">
    <span class="md-ellipsis">
      Sender Contract: CrossChainSender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiver-contract-crosschainreceiver" class="md-nav__link">
    <span class="md-ellipsis">
      Receiver Contract: CrossChainReceiver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the Contracts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-tokens-across-chains" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer Tokens Across Chains
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transfer Tokens Across Chains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-recap" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Recap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transfer-script" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transfer-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Transfer Tokens
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
    
    <article class="md-content__inner md-typeset ">
      
        


<h1 id="cross-chain-token-transfers">Cross-Chain Token Transfers</h1>
<h2 id="introduction">Introduction</h2>
<p>In this tutorial, you'll learn how to create a simple cross-chain token transfer system using the Wormhole protocol via the <a href="https://github.com/wormhole-foundation/wormhole-solidity-sdk" target="_blank">Wormhole Solidity SDK</a>. We'll guide you through building and deploying smart contracts that enable seamless token transfers of IERC-20 tokens between blockchains. Whether you're a developer looking to explore cross-chain applications or just interested in the Wormhole protocol, this guide will help you understand the fundamentals.</p>
<p>By the end of this tutorial, you'll have a working cross-chain token transfer system built with the powerful tools provided by the Wormhole Solidity SDK, which you can further customize and integrate into your projects.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin, ensure you have the following:</p>
<ul>
<li><a href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" target="_blank">Node.js and npm</a> installed on your machine</li>
<li><a href="https://book.getfoundry.sh/getting-started/installation" target="_blank">Foundry</a> for deploying contracts</li>
<li>TestNet tokens for <a href="https://core.app/tools/testnet-faucet/?token=C" target="_blank">Avalanche-Fuji</a> and <a href="https://faucet.celo.org/alfajores" target="_blank">Celo-Alfajores</a> to cover gas fees</li>
<li><a href="https://faucet.circle.com/" target="_blank">USDC TestNet</a> tokens on Avalanche-Fuji or/and Celo-Alfajores for cross-chain transfer</li>
<li>Wallet private key</li>
</ul>
<h2 id="valid-tokens-for-transfer">Valid Tokens for Transfer</h2>
<p>It's important to note that this tutorial leverages <a href="https://github.com/wormhole-foundation/wormhole/blob/6130bbb6f456b42b789a71f7ea2fd049d632d2fb/ethereum/contracts/bridge/TokenBridge.sol" target="_blank">Wormhole's TokenBridge</a> to transfer tokens between chains. So, the tokens you'd like to transfer must have an attestation on the <code>TokenBridge</code> contract of the target blockchain.</p>
<p>To simplify this process, we've included a tool for verifying if a token has an attestation on the target chain. This tool uses the <a href="https://github.com/wormhole-foundation/wormhole/blob/6130bbb6f456b42b789a71f7ea2fd049d632d2fb/ethereum/contracts/bridge/BridgeGetters.sol#L50-L52" target="_blank"><code>wrappedAsset</code></a> function from the <code>TokenBridge</code> contract. If the token has an attestation, the <code>wrappedAsset</code> function returns the address of the wrapped token on the target chain; otherwise, it returns the zero address.</p>
<details class="- tip">
<summary>Check Token Attestation</summary>
<ol>
<li>Clone the <a href="https://github.com/martin0995/cross-chain-token-transfers" target="_blank">repository</a> and navigate to the project directory:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/martin0995/cross-chain-token-transfers.git
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>cross-chain-token-transfers
</span></code></pre></div></li>
<li>
<p>Install the dependencies:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>npm<span class="w"> </span>install
</span></code></pre></div></p>
</li>
<li>
<p>Run the script to check token attestation:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>npm<span class="w"> </span>run<span class="w"> </span>verify
</span></code></pre></div></p>
</li>
<li>
<p>Follow the prompts:</p>
<ol>
<li>Enter the RPC URL of the target chain</li>
<li>Enter the <code>TokenBridge</code> contract address on the target chain</li>
<li>Enter the token contract address on the source chain</li>
<li>Enter the source chain ID</li>
</ol>
</li>
<li>
<p>The expected output when the token has an attestation:</p>
<p><div id="termynal" data-termynal>
    <span data-ty="input"><span class="file-path"></span>npm run verify</span>
    <span data-ty> &gt; cross-chain-token-transfer@1.0.0 verify</span>
    <span data-ty> &gt; npx ts-node script/check-attestation.ts</span>
  <span data-ty> </span>
    <span data-ty> Enter the TARGET chain RPC URL: https://alfajores-forno.celo-testnet.org</span>
    <span data-ty> Enter the Token Bridge contract address on the TARGET chain: 0x05...E153</span>
  <span data-ty> Enter the token contract address on the SOURCE chain: 0x54...bc65</span>
  <span data-ty> Enter the SOURCE chain ID: 6</span>
  <span data-ty> The token is attested on the target chain. Wrapped token address: 0xDDB349c976cA2C873644F21f594767Eb5390C831</span>
    <span data-ty="input"><span class="file-path"></span></span>
</div></p>
</li>
</ol>
<p>Using this tool ensures that you only attempt to transfer tokens with verified attestations, avoiding any potential issues during the cross-chain transfer process.</p>
</details>
<h2 id="project-setup">Project Setup</h2>
<p>Let's start by initializing a new Foundry project. This will set up a basic structure for our smart contracts.</p>
<ol>
<li>
<p>Open your terminal and run the following command to initialize a new Foundry project:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>forge<span class="w"> </span>init<span class="w"> </span>cross-chain-token-transfers
</span></code></pre></div>
<p>This will create a new directory named <code>cross-chain-token-transfers</code> with a basic project structure. This also initializes a new <code>git</code> repository.</p>
</li>
<li>
<p>Navigate into the newly created project directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">cd</span><span class="w"> </span>cross-chain-token-transfers
</span></code></pre></div>
</li>
<li>
<p>Install the Wormhole Solidity SDK:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>forge<span class="w"> </span>install<span class="w"> </span>wormhole-foundation/wormhole-solidity-sdk
</span></code></pre></div>
<p>To ease development, we'll use the Wormhole Solidity SDK, which provides useful helpers for cross-chain development.
This SDK includes the <code>TokenSender</code> and <code>TokenReceiver</code> abstract classes, which simplify sending and receiving tokens across chains.</p>
</li>
</ol>
<h2 id="build-cross-chain-contracts">Build Cross-Chain Contracts</h2>
<p>In this section, we'll build two smart contracts to send tokens from a source chain and receive them on a target chain. These contracts will interact with the Wormhole protocol to facilitate secure and seamless cross-chain token transfers.</p>
<p>At a high level, our contracts will:</p>
<ol>
<li>Send tokens from one blockchain to another using the Wormhole protocol</li>
<li>Receive and process the tokens on the target chain, ensuring they are correctly transferred to the intended recipient</li>
</ol>
<p>Before diving into the contract implementation steps, let’s first break down the key parts of the contracts.</p>
<h3 id="sender-contract-crosschainsender">Sender Contract: CrossChainSender</h3>
<p>The <code>CrossChainSender</code> contract calculates the cost of sending tokens across chains and then facilitates the actual token transfer.</p>
<p>Let's start writing the <code>CrossChainSender</code> contract:</p>
<ol>
<li>
<p>Create a new file named <code>CrossChainSender.sol</code> in the <code>/src</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>touch<span class="w"> </span>src/CrossChainSender.sol
</span></code></pre></div>
</li>
<li>
<p>Open the file. First, we'll start with the imports and the contract setup:</p>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">// SPDX-License-Identifier: MIT</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.13</span><span class="p">;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/WormholeRelayerSDK.sol&quot;</span><span class="p">;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/interfaces/IERC20.sol&quot;</span><span class="p">;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="k">contract</span><span class="w"> </span><span class="ni">CrossChainSender</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>TokenSender<span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">constant</span><span class="w"> </span>GAS_LIMIT<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">250</span>_000<span class="p">;</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="kt">constructor</span><span class="p">(</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormholeRelayer</span><span class="p">,</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_tokenBridge</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormhole</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span>TokenBase<span class="p">(</span>_wormholeRelayer<span class="p">,</span><span class="w"> </span>_tokenBridge<span class="p">,</span><span class="w"> </span>_wormhole<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div>
<p>This sets up the basic structure of the contract, including the necessary imports and the constructor that initializes the contract with the Wormhole-related addresses.</p>
</li>
<li>
<p>Next, let's add a function that estimates the cost of sending tokens across chains:</p>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">quoteCrossChainDeposit</span><span class="p">(</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">        </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">targetChain</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">cost</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deliveryCost</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">        </span><span class="p">(</span>deliveryCost<span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>wormholeRelayer<span class="p">.</span>quoteEVMDeliveryPrice<span class="p">(</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">            </span>targetChain<span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">            </span><span class="m m-Decimal">0</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">            </span>GAS_LIMIT
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">        </span>cost<span class="w"> </span><span class="o">=</span><span class="w"> </span>deliveryCost<span class="w"> </span><span class="o">+</span><span class="w"> </span>wormhole<span class="p">.</span>messageFee<span class="p">();</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p>This function, <code>quoteCrossChainDeposit</code>, helps calculate the cost of transferring tokens to a different chain. It factors in the delivery cost and the cost of publishing a message via the Wormhole protocol.</p>
</li>
<li>
<p>Finally, we'll add the function that sends the tokens across chains:</p>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sendCrossChainDeposit</span><span class="p">(</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">        </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">targetChain</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">targetReceiver</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>quoteCrossChainDeposit<span class="p">(</span>targetChain<span class="p">);</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="kt">require</span><span class="p">(</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">            </span><span class="k">msg.value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>cost<span class="p">,</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">            </span><span class="s2">&quot;msg.value must equal quoteCrossChainDeposit(targetChain)&quot;</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">        </span>IERC20<span class="p">(</span>token<span class="p">).</span>transferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"> </span>amount<span class="p">);</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>payload<span class="w"> </span><span class="o">=</span><span class="w"> </span>abi<span class="p">.</span>encode<span class="p">(</span>recipient<span class="p">);</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">        </span>sendTokenWithPayloadToEvm<span class="p">(</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">            </span>targetChain<span class="p">,</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">            </span>targetReceiver<span class="p">,</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">            </span>payload<span class="p">,</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">            </span><span class="m m-Decimal">0</span><span class="p">,</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">            </span>GAS_LIMIT<span class="p">,</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">            </span>token<span class="p">,</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">            </span>amount
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="p">}</span>
</span></code></pre></div>
<p>This <code>sendCrossChainDeposit</code> function is where the actual token transfer happens. It sends the tokens to the recipient on the target chain using the Wormhole protocol.</p>
</li>
</ol>
<p>Here’s a breakdown of what happens in each step of the <code>sendCrossChainDeposit</code> function:</p>
<ol>
<li>
<p><strong>Cost calculation</strong> - the function starts by calculating the cost of the cross-chain transfer using <code>quoteCrossChainDeposit</code>(<code>targetChain</code>). This cost includes both the delivery fee and the Wormhole message fee. The <code>sendCrossChainDeposit</code> function then checks that the user has sent the correct amount of Ether to cover this cost (<code>msg.value</code>)</p>
</li>
<li>
<p><strong>Token transfer to contract</strong> - the next step is to transfer the specified amount of tokens from the user to the contract itself using <code>IERC-20(token).transferFrom(msg.sender, address(this), amount)</code>. This ensures that the contract has custody of the tokens before initiating the cross-chain transfer</p>
</li>
<li>
<p><strong>Payload encoding</strong> - The recipient's address on the target chain is encoded into a payload using <code>abi.encode(recipient)</code>. This payload will be sent along with the token transfer, so the target contract knows who should receive the tokens on the destination chain</p>
</li>
<li>
<p><strong>Cross-chain transfer</strong> - the <code>sendTokenWithPayloadToEvm</code> function is called to initiate the cross-chain token transfer. This function:</p>
<ul>
<li>Specifies the <code>targetChain</code> (the Wormhole chain ID of the destination blockchain).</li>
<li>Sends the <code>targetReceiver</code> contract address on the target chain that will receive the tokens.</li>
<li>Attaches the payload containing the recipient's address.</li>
<li>Sets the <code>GAS_LIMIT</code> for the transaction.</li>
<li>Passes the token <code>address</code> and <code>amount</code> to transfer.</li>
</ul>
<p>This triggers the Wormhole protocol to handle the cross-chain messaging and token transfer, ensuring the tokens and payload reach the correct destination on the target chain.</p>
</li>
</ol>
<p>You can find the complete code for the <code>CrossChainSender.sol</code> below.</p>
<details class="code">
<summary>MessageSender.sol</summary>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// SPDX-License-Identifier: MIT</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.13</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/WormholeRelayerSDK.sol&quot;</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/interfaces/IERC20.sol&quot;</span><span class="p">;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">contract</span><span class="w"> </span><span class="ni">CrossChainSender</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>TokenSender<span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">constant</span><span class="w"> </span>GAS_LIMIT<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">250</span>_000<span class="p">;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="kt">constructor</span><span class="p">(</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormholeRelayer</span><span class="p">,</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_tokenBridge</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormhole</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span>TokenBase<span class="p">(</span>_wormholeRelayer<span class="p">,</span><span class="w"> </span>_tokenBridge<span class="p">,</span><span class="w"> </span>_wormhole<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">    </span><span class="c1">// Function to get the estimated cost for cross-chain deposit</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">quoteCrossChainDeposit</span><span class="p">(</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">        </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">targetChain</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">cost</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deliveryCost</span><span class="p">;</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">        </span><span class="p">(</span>deliveryCost<span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>wormholeRelayer<span class="p">.</span>quoteEVMDeliveryPrice<span class="p">(</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">            </span>targetChain<span class="p">,</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">            </span><span class="m m-Decimal">0</span><span class="p">,</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">            </span>GAS_LIMIT
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">        </span>cost<span class="w"> </span><span class="o">=</span><span class="w"> </span>deliveryCost<span class="w"> </span><span class="o">+</span><span class="w"> </span>wormhole<span class="p">.</span>messageFee<span class="p">();</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="w">    </span><span class="c1">// Function to send tokens and payload across chains</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sendCrossChainDeposit</span><span class="p">(</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">        </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">targetChain</span><span class="p">,</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">targetReceiver</span><span class="p">,</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>quoteCrossChainDeposit<span class="p">(</span>targetChain<span class="p">);</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">        </span><span class="kt">require</span><span class="p">(</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">            </span><span class="k">msg.value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>cost<span class="p">,</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">            </span><span class="s2">&quot;msg.value must equal quoteCrossChainDeposit(targetChain)&quot;</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="w">        </span>IERC20<span class="p">(</span>token<span class="p">).</span>transferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"> </span>amount<span class="p">);</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>payload<span class="w"> </span><span class="o">=</span><span class="w"> </span>abi<span class="p">.</span>encode<span class="p">(</span>recipient<span class="p">);</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">        </span>sendTokenWithPayloadToEvm<span class="p">(</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="w">            </span>targetChain<span class="p">,</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="w">            </span>targetReceiver<span class="p">,</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">            </span>payload<span class="p">,</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a><span class="w">            </span><span class="m m-Decimal">0</span><span class="p">,</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">            </span>GAS_LIMIT<span class="p">,</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="w">            </span>token<span class="p">,</span>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="w">            </span>amount
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a><span class="p">}</span>
</span></code></pre></div>
</details>
<h3 id="receiver-contract-crosschainreceiver">Receiver Contract: CrossChainReceiver</h3>
<p>The <code>CrossChainReceiver</code> contract is designed to handle the receipt of tokens and payloads from another blockchain. It ensures that the tokens are correctly transferred to the designated recipient on the receiving chain.</p>
<p>Let's start writing the <code>CrossChainReceiver</code> contract:</p>
<ol>
<li>
<p>Create a new file named <code>CrossChainReceiver.sol</code> in the <code>/src</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>touch<span class="w"> </span>src/CrossChainReceiver.sol
</span></code></pre></div>
</li>
<li>
<p>Open the file. First, we'll start with the imports and the contract setup:</p>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">// SPDX-License-Identifier: MIT</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.13</span><span class="p">;</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/WormholeRelayerSDK.sol&quot;</span><span class="p">;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/interfaces/IERC20.sol&quot;</span><span class="p">;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="k">contract</span><span class="w"> </span><span class="ni">CrossChainReceiver</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>TokenReceiver<span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="c1">// The Wormhole relayer and registeredSenders are inherited from the Base.sol contract</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span><span class="kt">constructor</span><span class="p">(</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormholeRelayer</span><span class="p">,</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_tokenBridge</span><span class="p">,</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormhole</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span>TokenBase<span class="p">(</span>_wormholeRelayer<span class="p">,</span><span class="w"> </span>_tokenBridge<span class="p">,</span><span class="w"> </span>_wormhole<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div>
<p>Similar to the <code>CrossChainSender</code> contract, this sets up the basic structure of the contract, including the necessary imports and the constructor that initializes the contract with the Wormhole-related addresses.</p>
</li>
<li>
<p>Next, let's add a function to handle receiving the payload and tokens:</p>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">receivePayloadAndTokens</span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>payload<span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">        </span>TokenReceived<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>receivedTokens<span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">sourceAddress</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">        </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">sourceChain</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="c1">// deliveryHash</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">        </span><span class="kt">internal</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">        </span>override
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">        </span>onlyWormholeRelayer
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">        </span>isRegisteredSender<span class="p">(</span>sourceChain<span class="p">,</span><span class="w"> </span>sourceAddress<span class="p">)</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">        </span><span class="kt">require</span><span class="p">(</span>receivedTokens<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Expected 1 token transfer&quot;</span><span class="p">);</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">        </span><span class="c1">// Decode the recipient address from the payload</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>abi<span class="p">.</span>decode<span class="p">(</span>payload<span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">));</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">        </span><span class="c1">// Transfer the received tokens to the intended recipient</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">        </span>IERC20<span class="p">(</span>receivedTokens<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>tokenAddress<span class="p">).</span>transfer<span class="p">(</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">            </span>recipient<span class="p">,</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">            </span>receivedTokens<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>amount
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="p">}</span>
</span></code></pre></div>
<p>This <code>receivePayloadAndTokens</code> function processes the tokens and payload sent from another chain, decodes the recipient address, and transfers the tokens to them using the Wormhole protocol. This function also validates the emitter (<code>sourceAddress</code>) to ensure the message comes from a trusted sender.</p>
<p>This function ensures that:</p>
<ul>
<li>It only processes one token transfer at a time</li>
<li>The <code>sourceAddress</code> is checked against a list of registered senders using the <code>isRegisteredSender</code> modifier, which verifies if the emitter is allowed to send tokens to this contract</li>
<li>The recipient address is decoded from the payload, and the received tokens are transferred to them using the ERC-20 interface</li>
</ul>
</li>
</ol>
<p>After we call <code>sendTokenWithPayloadToEvm</code> on the source chain, the message goes through the standard Wormhole message lifecycle. Once a <a href="/learn/infrastructure/vaas/" target="_blank">VAA (Verifiable Action Approval)</a> is available, the delivery provider will call <code>receivePayloadAndTokens</code> on the target chain and target address specified, with the appropriate inputs.</p>
<details class="tip">
<summary>Understanding the <code>TokenReceived</code> Struct</summary>
<p>Let’s delve into the fields provided to us in the <code>TokenReceived</code> struct:</p>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kt">struct</span><span class="w"> </span><span class="nv">TokenReceived</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">tokenHomeAddress</span><span class="p">;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">tokenHomeChain</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenAddress</span><span class="p">;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountNormalized</span><span class="p">;</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<p><strong><code>tokenHomeAddress</code></strong> - the original address of the token on its native chain. This is the same as the token field in the call to <code>sendTokenWithPayloadToEvm</code> unless the original token sent is a Wormhole-wrapped token. In that case, this will be the address of the original version of the token (on its native chain) in Wormhole address format (left-padded with 12 zeros)</p>
</li>
<li>
<p><strong><code>tokenHomeChain</code></strong> - the Wormhole chain ID corresponding to the home address above. This will typically be the source chain unless the original token sent is a Wormhole-wrapped asset, which will be the chain of the unwrapped version of the token</p>
</li>
<li>
<p><strong><code>tokenAddress</code></strong> - the address of the IERC-20 token on the target chain that has been transferred to this contract. If <code>tokenHomeChain</code> equals the target chain, this will be the same as <code>tokenHomeAddress</code>; otherwise, it will be the Wormhole-wrapped version of the token sent</p>
</li>
<li>
<p><strong><code>amount</code></strong> - the token amount sent to you with the same units as the original token. Since <code>TokenBridge</code> only sends with eight decimals of precision, if your token has 18 decimals, this will be the "amount" you sent, rounded down to the nearest multiple of 10^10</p>
</li>
<li>
<p><strong><code>amountNormalized</code></strong> - the amount of token divided by (1 if decimals ≤ 8, else 10^(decimals - 8))</p>
</li>
</ul>
</details>
<p>You can find the complete code for the <code>CrossChainReceiver.sol</code> contract below:</p>
<details class="code">
<summary>CrossChainReceiver.sol</summary>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// SPDX-License-Identifier: MIT</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.13</span><span class="p">;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/WormholeRelayerSDK.sol&quot;</span><span class="p">;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/wormhole-solidity-sdk/src/interfaces/IERC20.sol&quot;</span><span class="p">;</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="k">contract</span><span class="w"> </span><span class="ni">CrossChainReceiver</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>TokenReceiver<span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="c1">// The Wormhole relayer and registeredSenders are inherited from the Base.sol contract</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span><span class="kt">constructor</span><span class="p">(</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormholeRelayer</span><span class="p">,</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_tokenBridge</span><span class="p">,</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">_wormhole</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span>TokenBase<span class="p">(</span>_wormholeRelayer<span class="p">,</span><span class="w"> </span>_tokenBridge<span class="p">,</span><span class="w"> </span>_wormhole<span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">    </span><span class="c1">// Function to receive the cross-chain payload and tokens with emitter validation</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">receivePayloadAndTokens</span><span class="p">(</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>payload<span class="p">,</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">        </span>TokenReceived<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>receivedTokens<span class="p">,</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">sourceAddress</span><span class="p">,</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">        </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">sourceChain</span><span class="p">,</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="c1">// deliveryHash</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">        </span><span class="kt">internal</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">        </span>override
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">        </span>onlyWormholeRelayer
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">        </span>isRegisteredSender<span class="p">(</span>sourceChain<span class="p">,</span><span class="w"> </span>sourceAddress<span class="p">)</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">        </span><span class="kt">require</span><span class="p">(</span>receivedTokens<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Expected 1 token transfer&quot;</span><span class="p">);</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">        </span><span class="c1">// Decode the recipient address from the payload</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>abi<span class="p">.</span>decode<span class="p">(</span>payload<span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">));</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">        </span><span class="c1">// Transfer the received tokens to the intended recipient</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">        </span>IERC20<span class="p">(</span>receivedTokens<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>tokenAddress<span class="p">).</span>transfer<span class="p">(</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w">            </span>recipient<span class="p">,</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">            </span>receivedTokens<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>amount
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="p">}</span>
</span></code></pre></div>
</details>
<h2 id="deploy-the-contracts">Deploy the Contracts</h2>
<p>Now that you've written the <code>CrossChainSender</code> and <code>CrossChainReceiver</code> contracts, it's time to deploy them to your chosen networks.</p>
<ol>
<li>
<p><strong>Set up deployment configuration</strong> - before deploying, you must configure the networks and the deployment environment. This information is stored in a configuration file</p>
<ol>
<li>
<p>Create a directory named deploy-config in the root of your project:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>mkdir<span class="w"> </span>deploy-config
</span></code></pre></div>
</li>
<li>
<p>Create a <code>config.json</code> file in the <code>deploy-config</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>touch<span class="w"> </span>deploy-config/config.json
</span></code></pre></div>
</li>
<li>
<p>Open the <code>config.json</code> file and add the following configuration:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="nt">&quot;chains&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Avalanche testnet fuji&quot;</span><span class="p">,</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">            </span><span class="nt">&quot;chainId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">            </span><span class="nt">&quot;rpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.avax-test.network/ext/bc/C/rpc&quot;</span><span class="p">,</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">            </span><span class="nt">&quot;tokenBridge&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x61E44E506Ca5659E6c0bba9b678586fA2d729756&quot;</span><span class="p">,</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">            </span><span class="nt">&quot;wormholeRelayer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0xA3cF45939bD6260bcFe3D66bc73d60f19e49a8BB&quot;</span><span class="p">,</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">            </span><span class="nt">&quot;wormhole&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x7bbcE28e64B3F8b84d876Ab298393c38ad7aac4C&quot;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Celo Testnet&quot;</span><span class="p">,</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">            </span><span class="nt">&quot;chainId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">            </span><span class="nt">&quot;rpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://alfajores-forno.celo-testnet.org&quot;</span><span class="p">,</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">            </span><span class="nt">&quot;tokenBridge&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x05ca6037eC51F8b712eD2E6Fa72219FEaE74E153&quot;</span><span class="p">,</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">            </span><span class="nt">&quot;wormholeRelayer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x306B68267Deb7c5DfCDa3619E22E9Ca39C374f84&quot;</span><span class="p">,</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">            </span><span class="nt">&quot;wormhole&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x88505117CA88e7dd2eC6EA1E13f0948db2D50D56&quot;</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>This file specifies the details for each chain where you plan to deploy your contracts, including the RPC URL, the <code>TokenBridge</code> address, the Wormhole relayer, and the Wormhole Core Contract.</p>
<p>For a complete list of Wormhole contract addresses on various blockchains, refer to the <a href="/build/reference/contract-addresses/" target="_blank">Wormhole Contract Addresses</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can add your desired chains to this file by specifying the required fields for each chain. In this example, we use the Avalanche Fuji and Celo Alfajores TestNets.</p>
</div>
</li>
<li>
<p>Create a <code>contracts.json</code> file in the <code>deploy-config</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>deploy-config/contracts.json
</span></code></pre></div>
<p>This file can be left blank initially. It will be automatically updated with the deployed contract addresses after a successful deployment</p>
</li>
</ol>
</li>
<li>
<p><strong>Set up your Node.js environment</strong> - you'll need to set up your Node.js environment to run the deployment script</p>
<ol>
<li>
<p>Initialize a Node.js project:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>npm<span class="w"> </span>init<span class="w"> </span>-y
</span></code></pre></div>
</li>
<li>
<p>Install the necessary dependencies:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>npm<span class="w"> </span>install<span class="w"> </span>ethers<span class="w"> </span>dotenv<span class="w"> </span>readline-sync<span class="w"> </span>@types/readline-sync
</span></code></pre></div>
<p>These dependencies are required for the deployment script to work properly.</p>
</li>
</ol>
</li>
<li>
<p><strong>Compile your smart contracts</strong> - compile your smart contracts using Foundry. This ensures that your contracts are up-to-date and ready for deployment</p>
<ul>
<li>
<p>Run the following command to compile your contracts:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>forge<span class="w"> </span>build
</span></code></pre></div>
<p>This will generate the necessary ABI and bytecode files in a directory named <code>/out</code>.</p>
</li>
</ul>
<p>The expected output should be similar to this:</p>
<p><div id="termynal" data-termynal>
    <span data-ty="input"><span class="file-path"></span>forge build</span>
    <span data-ty> &gt; [⠒] Compiling...</span>
    <span data-ty> &gt; [⠰] Compiling 30 files with 0.8.23</span>
    <span data-ty> [⠔] Solc 0.8.23 finished in 2.29s</span>
    <span data-ty>Compiler run successful!</span>
    <span data-ty="input"><span class="file-path"></span></span>
</div></p>
</li>
<li>
<p><strong>Write the deployment script</strong> - you’ll need a script to automate the deployment of your contracts. Let’s create the deployment script</p>
<ol>
<li>
<p>Create a new file named <code>deploy.ts</code> in the <code>/script</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>touch<span class="w"> </span>script/deploy.ts
</span></code></pre></div>
</li>
<li>
<p>Open the file and load imports and configuration:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">BytesLike</span><span class="p">,</span><span class="w"> </span><span class="nx">ethers</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ethers&#39;</span><span class="p">;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">dotenv</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;dotenv&#39;</span><span class="p">;</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="k">import</span><span class="w"> </span><span class="nx">readlineSync</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;readline-sync&#39;</span><span class="p">;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="nx">dotenv</span><span class="p">.</span><span class="nx">config</span><span class="p">();</span>
</span></code></pre></div>
<p>Import the required libraries and modules to interact with Ethereum, handle file paths, load environment variables, and enable user interaction via the terminal.</p>
</li>
<li>
<p>Define interfaces to use for chain configuration and contract deployment:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">ChainConfig</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="nx">rpc</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">  </span><span class="nx">tokenBridge</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="nx">wormholeRelayer</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">  </span><span class="nx">wormhole</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="p">}</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">DeployedContracts</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">  </span><span class="p">[</span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">    </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">    </span><span class="nx">CrossChainSender?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">    </span><span class="nx">CrossChainReceiver?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">    </span><span class="nx">deployedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>These interfaces define the structure of the chain configuration and the contract deployment details.</p>
</li>
<li>
<p>Load and select the chains for deployment:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">loadConfig</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ChainConfig</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">configPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;../deploy-config/config.json&#39;</span><span class="p">);</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">configPath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">)).</span><span class="nx">chains</span><span class="p">;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="p">}</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="kd">function</span><span class="w"> </span><span class="nx">selectChain</span><span class="p">(</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">  </span><span class="nx">chains</span><span class="o">:</span><span class="w"> </span><span class="kt">ChainConfig</span><span class="p">[],</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">  </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;source&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;target&#39;</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ChainConfig</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\nSelect the </span><span class="si">${</span><span class="nx">role</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb"> chain:`</span><span class="p">);</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">  </span><span class="nx">chains</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">chain</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">chain</span><span class="p">.</span><span class="nx">description</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">chainIndex</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">    </span><span class="nx">readlineSync</span><span class="p">.</span><span class="nx">questionInt</span><span class="p">(</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">      </span><span class="sb">`\nEnter the number for the </span><span class="si">${</span><span class="nx">role</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb"> chain: `</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">chains</span><span class="p">[</span><span class="nx">chainIndex</span><span class="p">];</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>loadConfig</code> function reads the chain configuration from the <code>config.json</code> file, and the <code>selectChain</code> function allows the user to choose the source and target chains for deployment interactively. The user is prompted in the terminal to select which chains to use, making the process interactive and user-friendly.</p>
</li>
<li>
<p>Define the main function for deployment and load the chain configuration:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">chains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loadConfig</span><span class="p">();</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectChain</span><span class="p">(</span><span class="nx">chains</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;source&#39;</span><span class="p">);</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selectChain</span><span class="p">(</span><span class="nx">chains</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;target&#39;</span><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>The <code>main</code> function is the entry point for the deployment script</li>
<li>We then call the <code>loadConfig</code> function we previously defined to load the chain configuration from the <code>config.json</code> file</li>
</ul>
</li>
<li>
<p>Set up provider and wallet: </p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">rpc</span><span class="p">);</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">rpc</span><span class="p">);</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">wallet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Wallet</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceProvider</span><span class="p">);</span>
</span></code></pre></div>
<p>The scripts establish a connection to the blockchain using a provider and create a wallet instance using a private key. This wallet is responsible for signing the deployment transaction on the source chain.</p>
</li>
<li>
<p>Read the compiled contracts:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">senderJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">      </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">        </span><span class="nx">__dirname</span><span class="p">,</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">        </span><span class="s1">&#39;../out/CrossChainSender.sol/CrossChainSender.json&#39;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">      </span><span class="p">),</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">      </span><span class="s1">&#39;utf8&#39;</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">  </span><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>This code reads the <code>CrossChainSender.json</code> file, the compiled output of the <code>CrossChainSender.sol</code> contract</li>
<li>The file is in the <code>../out/</code> directory, which contains the ABI (Application Binary Interface) and bytecode generated during contract compilation</li>
<li>It uses the <code>fs.readFileSync</code> function to read the file and <code>JSON.parse</code> to convert the file contents (in JSON format) into a JavaScript object</li>
</ul>
</li>
<li>
<p>Extract the contract ABI and bytecode:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">abi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">senderJson</span><span class="p">.</span><span class="nx">abi</span><span class="p">;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">bytecode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">senderJson</span><span class="p">.</span><span class="nx">bytecode</span><span class="p">;</span>
</span></code></pre></div>
<ul>
<li><strong>ABI (Application Binary Interface)</strong> - defines the structure of the contract’s functions, events, and data types, allowing the front end to interact with the contract on the blockchain</li>
<li><strong>Bytecode</strong> - this is the compiled machine code that will be deployed to the blockchain to create the contract</li>
</ul>
</li>
<li>
<p>Create the Contract Factory:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">CrossChainSenderFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">ContractFactory</span><span class="p">(</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="nx">abi</span><span class="p">,</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="nx">bytecode</span><span class="p">,</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="nx">wallet</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">  </span><span class="p">);</span>
</span></code></pre></div>
<ul>
<li><strong><code>ethers.ContractFactory</code></strong> - creates a new contract factory using the ABI, bytecode, and a wallet (representing the signer). The contract factory is responsible for deploying instances of the contract to the blockchain</li>
<li>This is a crucial step for deploying the contract since the factory will create and deploy the <code>CrossChainSender</code> contract</li>
</ul>
</li>
<li>
<p>Deploy the <code>CrossChainSender</code> and <code>CrossChainReceiver</code> contracts:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1"><code>CrossChainSender</code></label><label for="__tabbed_1_2"><code>CrossChainReceiver</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">senderContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">CrossChainSenderFactory</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">      </span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">wormholeRelayer</span><span class="p">,</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">      </span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">tokenBridge</span><span class="p">,</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">      </span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">wormhole</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">senderContract</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetWallet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Wallet</span><span class="p">(</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="o">!</span><span class="p">,</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">      </span><span class="nx">targetProvider</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">receiverJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">      </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">        </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">          </span><span class="nx">__dirname</span><span class="p">,</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">          </span><span class="s1">&#39;../out/CrossChainReceiver.sol/CrossChainReceiver.json&#39;</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">        </span><span class="s1">&#39;utf8&#39;</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">      </span><span class="p">)</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">CrossChainReceiverFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">ContractFactory</span><span class="p">(</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">      </span><span class="nx">receiverJson</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">      </span><span class="nx">receiverJson</span><span class="p">.</span><span class="nx">bytecode</span><span class="p">,</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">      </span><span class="nx">targetWallet</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">receiverContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">CrossChainReceiverFactory</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w">      </span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">wormholeRelayer</span><span class="p">,</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w">      </span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">tokenBridge</span><span class="p">,</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="w">      </span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">wormhole</span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">receiverContract</span><span class="p">.</span><span class="nx">waitForDeployment</span><span class="p">();</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Both functions deploy the respective contracts to the selected chains.</p>
<p>For the <code>CrossChainReceiver</code> contract:</p>
<ul>
<li>It defines the wallet related to the target chain</li>
<li>The logic reads the compiled ABI and bytecode from the JSON file generated during compilation</li>
<li>It creates a new contract factory using the ABI, bytecode, and wallet</li>
<li>It deploys the contract to the selected chain passing in the Wormhole Relayer, <code>TokenBridge</code>, and Wormhole addresses</li>
</ul>
</li>
<li>
<p>Save the deployed contract addresses:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1"><code>senderAddress</code></label><label for="__tabbed_2_2"><code>receiverAddress</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">senderAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">senderContract</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">).</span><span class="nx">target</span><span class="p">;</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">      </span><span class="sb">`CrossChainSender on </span><span class="si">${</span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">description</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">senderAddress</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="p">);</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">receiverAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">receiverContract</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">).</span><span class="nx">target</span><span class="p">;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">      </span><span class="sb">`CrossChainReceiver on </span><span class="si">${</span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">description</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">receiverAddress</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="p">);</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>You may display the deployed contract addresses in the terminal or save them to a JSON file for future reference.</p>
</li>
<li>
<p>Register the <code>CrossChainSender</code> address on the target chain:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">CrossChainReceiverContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">      </span><span class="nx">receiverAddress</span><span class="p">,</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">      </span><span class="nx">receiverJson</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">      </span><span class="nx">targetWallet</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">CrossChainReceiverContract</span><span class="p">.</span><span class="nx">setRegisteredSender</span><span class="p">(</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">      </span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">,</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">      </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">zeroPadValue</span><span class="p">(</span><span class="nx">senderAddress</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">BytesLike</span><span class="p">,</span><span class="w"> </span><span class="mf">32</span><span class="p">)</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span></code></pre></div>
<p>After you deploy the <code>CrossChainReceiver</code> contract on the target network, the sender contract address from the source chain needs to be registered. This ensures that only messages from the registered <code>CrossChainSender</code> contract are processed.</p>
<p>This additional step is essential to enforce emitter validation, preventing unauthorized senders from delivering messages to the <code>CrossChainReceiver</code> contract.</p>
</li>
<li>
<p>Save the deployment details:</p>
<details class="- example">
<summary>Save Deployment Details Example</summary>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">deployedContractsPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">      </span><span class="nx">__dirname</span><span class="p">,</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">      </span><span class="s1">&#39;../deploy-config/contracts.json&#39;</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">deployedContracts</span><span class="o">:</span><span class="w"> </span><span class="kt">DeployedContracts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">deployedContractsPath</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">      </span><span class="nx">deployedContracts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">        </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">deployedContractsPath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">    </span><span class="c1">// Update the contracts.json file:</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">    </span><span class="c1">// If a contract already exists on a chain, update its address; otherwise, add a new entry.</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="w">      </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">        </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">sourceChain.description</span><span class="p">,</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">        </span><span class="nx">deployedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a><span class="w">    </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">].</span><span class="nx">CrossChainSender</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a><span class="w">      </span><span class="nx">senderAddress</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a><span class="w">    </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">].</span><span class="nx">deployedAt</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a><span class="w">      </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a><span class="w">        </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">targetChain.description</span><span class="p">,</span>
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a><span class="w">        </span><span class="nx">deployedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a><span class="w">    </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">].</span><span class="nx">CrossChainReceiver</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a><span class="w">      </span><span class="nx">receiverAddress</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a><span class="w">    </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">targetChain</span><span class="p">.</span><span class="nx">chainId</span><span class="p">].</span><span class="nx">deployedAt</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a><span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a>
</span><span id="__span-37-37"><a id="__codelineno-37-37" name="__codelineno-37-37" href="#__codelineno-37-37"></a><span class="w">    </span><span class="c1">// Save the updated contracts.json file</span>
</span><span id="__span-37-38"><a id="__codelineno-37-38" name="__codelineno-37-38" href="#__codelineno-37-38"></a><span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
</span><span id="__span-37-39"><a id="__codelineno-37-39" name="__codelineno-37-39" href="#__codelineno-37-39"></a><span class="w">      </span><span class="nx">deployedContractsPath</span><span class="p">,</span>
</span><span id="__span-37-40"><a id="__codelineno-37-40" name="__codelineno-37-40" href="#__codelineno-37-40"></a><span class="w">      </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">deployedContracts</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-37-41"><a id="__codelineno-37-41" name="__codelineno-37-41" href="#__codelineno-37-41"></a><span class="w">    </span><span class="p">);</span>
</span></code></pre></div>
</details>
<p>Add your desired logic to save the deployed contract addresses in a JSON file (or another format). This will be important later when transferring tokens, as you'll need these addresses to interact with the deployed contracts.</p>
</li>
<li>
<p>Handle errors and finalize the script:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;INSUFFICIENT_FUNDS&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">        </span><span class="s1">&#39;Error: Insufficient funds for deployment. Please make sure your wallet has enough funds to cover the gas fees.&#39;</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;An unexpected error occurred:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="p">}</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="p">});</span>
</span></code></pre></div>
<p>The try-catch block wraps the deployment logic to catch any errors that may occur.</p>
<ul>
<li>If the error is due to insufficient funds, it logs a clear message about needing more gas fees</li>
<li>For any other errors, it logs the specific error message to help with debugging</li>
</ul>
<p>The <code>process.exit(1)</code> ensures that the script exits with a failure status code if any error occurs.</p>
</li>
</ol>
<p>You can find the full code for the <code>deploy.ts</code> file below:</p>
<details class="code">
<summary>deploy.ts</summary>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kt">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>BytesLike<span class="p">,</span><span class="w"> </span>ethers<span class="w"> </span><span class="p">}</span><span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;ethers&#39;</span><span class="p">;</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="kt">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>as<span class="w"> </span>fs<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="kt">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>as<span class="w"> </span>path<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="kt">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>as<span class="w"> </span>dotenv<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;dotenv&#39;</span><span class="p">;</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="kt">import</span><span class="w"> </span>readlineSync<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;readline-sync&#39;</span><span class="p">;</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>dotenv<span class="p">.</span>config<span class="p">();</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>interface<span class="w"> </span>ChainConfig<span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">  </span>description<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">  </span>chainId<span class="o">:</span><span class="w"> </span>number<span class="p">;</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">  </span>rpc<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">  </span>tokenBridge<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">  </span>wormholeRelayer<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">  </span>wormhole<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="p">}</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>interface<span class="w"> </span>DeployedContracts<span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">  </span><span class="p">[</span>chainId<span class="o">:</span><span class="w"> </span>number<span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">    </span>networkName<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">    </span>CrossChainSender<span class="o">?:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="w">    </span>CrossChainReceiver<span class="o">?:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a><span class="w">    </span>deployedAt<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="p">}</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="kt">function</span><span class="w"> </span><span class="nv">loadConfig</span><span class="p">()</span><span class="o">:</span><span class="w"> </span>ChainConfig<span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">  </span>const<span class="w"> </span>configPath<span class="w"> </span><span class="o">=</span><span class="w"> </span>path<span class="p">.</span>resolve<span class="p">(</span>__dirname<span class="p">,</span><span class="w"> </span><span class="s1">&#39;../deploy-config/config.json&#39;</span><span class="p">);</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="w">  </span><span class="kt">return</span><span class="w"> </span>JSON<span class="p">.</span>parse<span class="p">(</span>fs<span class="p">.</span>readFileSync<span class="p">(</span>configPath<span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">)).</span>chains<span class="p">;</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a><span class="p">}</span>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="kt">function</span><span class="w"> </span><span class="nv">selectChain</span><span class="p">(</span>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="w">  </span>chains<span class="o">:</span><span class="w"> </span>ChainConfig<span class="p">[],</span>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">  </span>role<span class="o">:</span><span class="w"> </span><span class="s1">&#39;source&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;target&#39;</span>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a><span class="p">)</span><span class="o">:</span><span class="w"> </span>ChainConfig<span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="w">  </span>console<span class="p">.</span>log<span class="p">(</span><span class="err">`\</span>nSelect<span class="w"> </span>the<span class="w"> </span><span class="err">$</span><span class="p">{</span>role<span class="p">.</span>toUpperCase<span class="p">()}</span><span class="w"> </span>chain<span class="o">:</span><span class="err">`</span><span class="p">);</span>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a><span class="w">  </span>chains<span class="p">.</span>forEach<span class="p">((</span>chain<span class="p">,</span><span class="w"> </span>index<span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span><span class="err">`$</span><span class="p">{</span>index<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">{</span>chain<span class="p">.</span>description<span class="p">}</span><span class="err">`</span><span class="p">);</span>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="w">  </span>const<span class="w"> </span>chainIndex<span class="w"> </span><span class="o">=</span>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="w">    </span>readlineSync<span class="p">.</span>questionInt<span class="p">(</span>
</span><span id="__span-39-43"><a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a><span class="w">      </span><span class="err">`\</span>nEnter<span class="w"> </span>the<span class="w"> </span>number<span class="w"> </span><span class="kt">for</span><span class="w"> </span>the<span class="w"> </span><span class="err">$</span><span class="p">{</span>role<span class="p">.</span>toUpperCase<span class="p">()}</span><span class="w"> </span>chain<span class="o">:</span><span class="w"> </span><span class="err">`</span>
</span><span id="__span-39-44"><a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
</span><span id="__span-39-45"><a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a><span class="w">  </span><span class="kt">return</span><span class="w"> </span>chains<span class="p">[</span>chainIndex<span class="p">];</span>
</span><span id="__span-39-46"><a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a><span class="p">}</span>
</span><span id="__span-39-47"><a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a>
</span><span id="__span-39-48"><a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a>async<span class="w"> </span><span class="kt">function</span><span class="w"> </span><span class="nv">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-49"><a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a><span class="w">  </span>const<span class="w"> </span>chains<span class="w"> </span><span class="o">=</span><span class="w"> </span>loadConfig<span class="p">();</span>
</span><span id="__span-39-50"><a id="__codelineno-39-50" name="__codelineno-39-50" href="#__codelineno-39-50"></a>
</span><span id="__span-39-51"><a id="__codelineno-39-51" name="__codelineno-39-51" href="#__codelineno-39-51"></a><span class="w">  </span>const<span class="w"> </span>sourceChain<span class="w"> </span><span class="o">=</span><span class="w"> </span>selectChain<span class="p">(</span>chains<span class="p">,</span><span class="w"> </span><span class="s1">&#39;source&#39;</span><span class="p">);</span>
</span><span id="__span-39-52"><a id="__codelineno-39-52" name="__codelineno-39-52" href="#__codelineno-39-52"></a><span class="w">  </span>const<span class="w"> </span>targetChain<span class="w"> </span><span class="o">=</span><span class="w"> </span>selectChain<span class="p">(</span>chains<span class="p">,</span><span class="w"> </span><span class="s1">&#39;target&#39;</span><span class="p">);</span>
</span><span id="__span-39-53"><a id="__codelineno-39-53" name="__codelineno-39-53" href="#__codelineno-39-53"></a>
</span><span id="__span-39-54"><a id="__codelineno-39-54" name="__codelineno-39-54" href="#__codelineno-39-54"></a><span class="w">  </span>const<span class="w"> </span>sourceProvider<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>JsonRpcProvider<span class="p">(</span>sourceChain<span class="p">.</span>rpc<span class="p">);</span>
</span><span id="__span-39-55"><a id="__codelineno-39-55" name="__codelineno-39-55" href="#__codelineno-39-55"></a><span class="w">  </span>const<span class="w"> </span>targetProvider<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>JsonRpcProvider<span class="p">(</span>targetChain<span class="p">.</span>rpc<span class="p">);</span>
</span><span id="__span-39-56"><a id="__codelineno-39-56" name="__codelineno-39-56" href="#__codelineno-39-56"></a><span class="w">  </span>const<span class="w"> </span>wallet<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>Wallet<span class="p">(</span>process<span class="p">.</span>env<span class="p">.</span>PRIVATE_KEY<span class="o">!</span><span class="p">,</span><span class="w"> </span>sourceProvider<span class="p">);</span>
</span><span id="__span-39-57"><a id="__codelineno-39-57" name="__codelineno-39-57" href="#__codelineno-39-57"></a>
</span><span id="__span-39-58"><a id="__codelineno-39-58" name="__codelineno-39-58" href="#__codelineno-39-58"></a><span class="w">  </span>const<span class="w"> </span>senderJson<span class="w"> </span><span class="o">=</span><span class="w"> </span>JSON<span class="p">.</span>parse<span class="p">(</span>
</span><span id="__span-39-59"><a id="__codelineno-39-59" name="__codelineno-39-59" href="#__codelineno-39-59"></a><span class="w">    </span>fs<span class="p">.</span>readFileSync<span class="p">(</span>
</span><span id="__span-39-60"><a id="__codelineno-39-60" name="__codelineno-39-60" href="#__codelineno-39-60"></a><span class="w">      </span>path<span class="p">.</span>resolve<span class="p">(</span>
</span><span id="__span-39-61"><a id="__codelineno-39-61" name="__codelineno-39-61" href="#__codelineno-39-61"></a><span class="w">        </span>__dirname<span class="p">,</span>
</span><span id="__span-39-62"><a id="__codelineno-39-62" name="__codelineno-39-62" href="#__codelineno-39-62"></a><span class="w">        </span><span class="s1">&#39;../out/CrossChainSender.sol/CrossChainSender.json&#39;</span>
</span><span id="__span-39-63"><a id="__codelineno-39-63" name="__codelineno-39-63" href="#__codelineno-39-63"></a><span class="w">      </span><span class="p">),</span>
</span><span id="__span-39-64"><a id="__codelineno-39-64" name="__codelineno-39-64" href="#__codelineno-39-64"></a><span class="w">      </span><span class="s1">&#39;utf8&#39;</span>
</span><span id="__span-39-65"><a id="__codelineno-39-65" name="__codelineno-39-65" href="#__codelineno-39-65"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-39-66"><a id="__codelineno-39-66" name="__codelineno-39-66" href="#__codelineno-39-66"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-39-67"><a id="__codelineno-39-67" name="__codelineno-39-67" href="#__codelineno-39-67"></a>
</span><span id="__span-39-68"><a id="__codelineno-39-68" name="__codelineno-39-68" href="#__codelineno-39-68"></a><span class="w">  </span>const<span class="w"> </span>abi<span class="w"> </span><span class="o">=</span><span class="w"> </span>senderJson<span class="p">.</span>abi<span class="p">;</span>
</span><span id="__span-39-69"><a id="__codelineno-39-69" name="__codelineno-39-69" href="#__codelineno-39-69"></a><span class="w">  </span>const<span class="w"> </span>bytecode<span class="w"> </span><span class="o">=</span><span class="w"> </span>senderJson<span class="p">.</span>bytecode<span class="p">;</span>
</span><span id="__span-39-70"><a id="__codelineno-39-70" name="__codelineno-39-70" href="#__codelineno-39-70"></a>
</span><span id="__span-39-71"><a id="__codelineno-39-71" name="__codelineno-39-71" href="#__codelineno-39-71"></a><span class="w">  </span>const<span class="w"> </span>CrossChainSenderFactory<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>ContractFactory<span class="p">(</span>
</span><span id="__span-39-72"><a id="__codelineno-39-72" name="__codelineno-39-72" href="#__codelineno-39-72"></a><span class="w">    </span>abi<span class="p">,</span>
</span><span id="__span-39-73"><a id="__codelineno-39-73" name="__codelineno-39-73" href="#__codelineno-39-73"></a><span class="w">    </span>bytecode<span class="p">,</span>
</span><span id="__span-39-74"><a id="__codelineno-39-74" name="__codelineno-39-74" href="#__codelineno-39-74"></a><span class="w">    </span>wallet
</span><span id="__span-39-75"><a id="__codelineno-39-75" name="__codelineno-39-75" href="#__codelineno-39-75"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-39-76"><a id="__codelineno-39-76" name="__codelineno-39-76" href="#__codelineno-39-76"></a>
</span><span id="__span-39-77"><a id="__codelineno-39-77" name="__codelineno-39-77" href="#__codelineno-39-77"></a><span class="w">  </span>try<span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-78"><a id="__codelineno-39-78" name="__codelineno-39-78" href="#__codelineno-39-78"></a><span class="w">    </span>const<span class="w"> </span>senderContract<span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>CrossChainSenderFactory<span class="p">.</span>deploy<span class="p">(</span>
</span><span id="__span-39-79"><a id="__codelineno-39-79" name="__codelineno-39-79" href="#__codelineno-39-79"></a><span class="w">      </span>sourceChain<span class="p">.</span>wormholeRelayer<span class="p">,</span>
</span><span id="__span-39-80"><a id="__codelineno-39-80" name="__codelineno-39-80" href="#__codelineno-39-80"></a><span class="w">      </span>sourceChain<span class="p">.</span>tokenBridge<span class="p">,</span>
</span><span id="__span-39-81"><a id="__codelineno-39-81" name="__codelineno-39-81" href="#__codelineno-39-81"></a><span class="w">      </span>sourceChain<span class="p">.</span>wormhole
</span><span id="__span-39-82"><a id="__codelineno-39-82" name="__codelineno-39-82" href="#__codelineno-39-82"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-83"><a id="__codelineno-39-83" name="__codelineno-39-83" href="#__codelineno-39-83"></a><span class="w">    </span>await<span class="w"> </span>senderContract<span class="p">.</span>waitForDeployment<span class="p">();</span>
</span><span id="__span-39-84"><a id="__codelineno-39-84" name="__codelineno-39-84" href="#__codelineno-39-84"></a>
</span><span id="__span-39-85"><a id="__codelineno-39-85" name="__codelineno-39-85" href="#__codelineno-39-85"></a><span class="w">    </span><span class="c1">// Safely access the deployed contract&#39;s address</span>
</span><span id="__span-39-86"><a id="__codelineno-39-86" name="__codelineno-39-86" href="#__codelineno-39-86"></a><span class="w">    </span>const<span class="w"> </span>senderAddress<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>senderContract<span class="w"> </span>as<span class="w"> </span>ethers<span class="p">.</span>Contract<span class="p">).</span>target<span class="p">;</span>
</span><span id="__span-39-87"><a id="__codelineno-39-87" name="__codelineno-39-87" href="#__codelineno-39-87"></a><span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span>
</span><span id="__span-39-88"><a id="__codelineno-39-88" name="__codelineno-39-88" href="#__codelineno-39-88"></a><span class="w">      </span><span class="err">`</span>CrossChainSender<span class="w"> </span>on<span class="w"> </span><span class="err">$</span><span class="p">{</span>sourceChain<span class="p">.</span>description<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">{</span>senderAddress<span class="p">}</span><span class="err">`</span>
</span><span id="__span-39-89"><a id="__codelineno-39-89" name="__codelineno-39-89" href="#__codelineno-39-89"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-90"><a id="__codelineno-39-90" name="__codelineno-39-90" href="#__codelineno-39-90"></a>
</span><span id="__span-39-91"><a id="__codelineno-39-91" name="__codelineno-39-91" href="#__codelineno-39-91"></a><span class="w">    </span>const<span class="w"> </span>targetWallet<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>Wallet<span class="p">(</span>
</span><span id="__span-39-92"><a id="__codelineno-39-92" name="__codelineno-39-92" href="#__codelineno-39-92"></a><span class="w">      </span>process<span class="p">.</span>env<span class="p">.</span>PRIVATE_KEY<span class="o">!</span><span class="p">,</span>
</span><span id="__span-39-93"><a id="__codelineno-39-93" name="__codelineno-39-93" href="#__codelineno-39-93"></a><span class="w">      </span>targetProvider
</span><span id="__span-39-94"><a id="__codelineno-39-94" name="__codelineno-39-94" href="#__codelineno-39-94"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-95"><a id="__codelineno-39-95" name="__codelineno-39-95" href="#__codelineno-39-95"></a><span class="w">    </span>const<span class="w"> </span>receiverJson<span class="w"> </span><span class="o">=</span><span class="w"> </span>JSON<span class="p">.</span>parse<span class="p">(</span>
</span><span id="__span-39-96"><a id="__codelineno-39-96" name="__codelineno-39-96" href="#__codelineno-39-96"></a><span class="w">      </span>fs<span class="p">.</span>readFileSync<span class="p">(</span>
</span><span id="__span-39-97"><a id="__codelineno-39-97" name="__codelineno-39-97" href="#__codelineno-39-97"></a><span class="w">        </span>path<span class="p">.</span>resolve<span class="p">(</span>
</span><span id="__span-39-98"><a id="__codelineno-39-98" name="__codelineno-39-98" href="#__codelineno-39-98"></a><span class="w">          </span>__dirname<span class="p">,</span>
</span><span id="__span-39-99"><a id="__codelineno-39-99" name="__codelineno-39-99" href="#__codelineno-39-99"></a><span class="w">          </span><span class="s1">&#39;../out/CrossChainReceiver.sol/CrossChainReceiver.json&#39;</span>
</span><span id="__span-39-100"><a id="__codelineno-39-100" name="__codelineno-39-100" href="#__codelineno-39-100"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-39-101"><a id="__codelineno-39-101" name="__codelineno-39-101" href="#__codelineno-39-101"></a><span class="w">        </span><span class="s1">&#39;utf8&#39;</span>
</span><span id="__span-39-102"><a id="__codelineno-39-102" name="__codelineno-39-102" href="#__codelineno-39-102"></a><span class="w">      </span><span class="p">)</span>
</span><span id="__span-39-103"><a id="__codelineno-39-103" name="__codelineno-39-103" href="#__codelineno-39-103"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-104"><a id="__codelineno-39-104" name="__codelineno-39-104" href="#__codelineno-39-104"></a><span class="w">    </span>const<span class="w"> </span>CrossChainReceiverFactory<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>ContractFactory<span class="p">(</span>
</span><span id="__span-39-105"><a id="__codelineno-39-105" name="__codelineno-39-105" href="#__codelineno-39-105"></a><span class="w">      </span>receiverJson<span class="p">.</span>abi<span class="p">,</span>
</span><span id="__span-39-106"><a id="__codelineno-39-106" name="__codelineno-39-106" href="#__codelineno-39-106"></a><span class="w">      </span>receiverJson<span class="p">.</span>bytecode<span class="p">,</span>
</span><span id="__span-39-107"><a id="__codelineno-39-107" name="__codelineno-39-107" href="#__codelineno-39-107"></a><span class="w">      </span>targetWallet
</span><span id="__span-39-108"><a id="__codelineno-39-108" name="__codelineno-39-108" href="#__codelineno-39-108"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-109"><a id="__codelineno-39-109" name="__codelineno-39-109" href="#__codelineno-39-109"></a>
</span><span id="__span-39-110"><a id="__codelineno-39-110" name="__codelineno-39-110" href="#__codelineno-39-110"></a><span class="w">    </span>const<span class="w"> </span>receiverContract<span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>CrossChainReceiverFactory<span class="p">.</span>deploy<span class="p">(</span>
</span><span id="__span-39-111"><a id="__codelineno-39-111" name="__codelineno-39-111" href="#__codelineno-39-111"></a><span class="w">      </span>targetChain<span class="p">.</span>wormholeRelayer<span class="p">,</span>
</span><span id="__span-39-112"><a id="__codelineno-39-112" name="__codelineno-39-112" href="#__codelineno-39-112"></a><span class="w">      </span>targetChain<span class="p">.</span>tokenBridge<span class="p">,</span>
</span><span id="__span-39-113"><a id="__codelineno-39-113" name="__codelineno-39-113" href="#__codelineno-39-113"></a><span class="w">      </span>targetChain<span class="p">.</span>wormhole
</span><span id="__span-39-114"><a id="__codelineno-39-114" name="__codelineno-39-114" href="#__codelineno-39-114"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-115"><a id="__codelineno-39-115" name="__codelineno-39-115" href="#__codelineno-39-115"></a><span class="w">    </span>await<span class="w"> </span>receiverContract<span class="p">.</span>waitForDeployment<span class="p">();</span>
</span><span id="__span-39-116"><a id="__codelineno-39-116" name="__codelineno-39-116" href="#__codelineno-39-116"></a>
</span><span id="__span-39-117"><a id="__codelineno-39-117" name="__codelineno-39-117" href="#__codelineno-39-117"></a><span class="w">    </span><span class="c1">// Safely access the deployed contract&#39;s address</span>
</span><span id="__span-39-118"><a id="__codelineno-39-118" name="__codelineno-39-118" href="#__codelineno-39-118"></a><span class="w">    </span>const<span class="w"> </span>receiverAddress<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>receiverContract<span class="w"> </span>as<span class="w"> </span>ethers<span class="p">.</span>Contract<span class="p">).</span>target<span class="p">;</span>
</span><span id="__span-39-119"><a id="__codelineno-39-119" name="__codelineno-39-119" href="#__codelineno-39-119"></a><span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span>
</span><span id="__span-39-120"><a id="__codelineno-39-120" name="__codelineno-39-120" href="#__codelineno-39-120"></a><span class="w">      </span><span class="err">`</span>CrossChainReceiver<span class="w"> </span>on<span class="w"> </span><span class="err">$</span><span class="p">{</span>targetChain<span class="p">.</span>description<span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">{</span>receiverAddress<span class="p">}</span><span class="err">`</span>
</span><span id="__span-39-121"><a id="__codelineno-39-121" name="__codelineno-39-121" href="#__codelineno-39-121"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-122"><a id="__codelineno-39-122" name="__codelineno-39-122" href="#__codelineno-39-122"></a>
</span><span id="__span-39-123"><a id="__codelineno-39-123" name="__codelineno-39-123" href="#__codelineno-39-123"></a><span class="w">    </span><span class="c1">// Register the sender contract in the receiver contract</span>
</span><span id="__span-39-124"><a id="__codelineno-39-124" name="__codelineno-39-124" href="#__codelineno-39-124"></a><span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span>
</span><span id="__span-39-125"><a id="__codelineno-39-125" name="__codelineno-39-125" href="#__codelineno-39-125"></a><span class="w">      </span><span class="err">`</span>Registering<span class="w"> </span>CrossChainSender<span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="p">{</span>senderAddress<span class="p">})</span><span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>valid<span class="w"> </span>sender<span class="w"> </span>in<span class="w"> </span>CrossChainReceiver<span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="p">{</span>receiverAddress<span class="p">})...</span><span class="err">`</span>
</span><span id="__span-39-126"><a id="__codelineno-39-126" name="__codelineno-39-126" href="#__codelineno-39-126"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-127"><a id="__codelineno-39-127" name="__codelineno-39-127" href="#__codelineno-39-127"></a>
</span><span id="__span-39-128"><a id="__codelineno-39-128" name="__codelineno-39-128" href="#__codelineno-39-128"></a><span class="w">    </span>const<span class="w"> </span>CrossChainReceiverContract<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>Contract<span class="p">(</span>
</span><span id="__span-39-129"><a id="__codelineno-39-129" name="__codelineno-39-129" href="#__codelineno-39-129"></a><span class="w">      </span>receiverAddress<span class="p">,</span>
</span><span id="__span-39-130"><a id="__codelineno-39-130" name="__codelineno-39-130" href="#__codelineno-39-130"></a><span class="w">      </span>receiverJson<span class="p">.</span>abi<span class="p">,</span>
</span><span id="__span-39-131"><a id="__codelineno-39-131" name="__codelineno-39-131" href="#__codelineno-39-131"></a><span class="w">      </span>targetWallet
</span><span id="__span-39-132"><a id="__codelineno-39-132" name="__codelineno-39-132" href="#__codelineno-39-132"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-133"><a id="__codelineno-39-133" name="__codelineno-39-133" href="#__codelineno-39-133"></a>
</span><span id="__span-39-134"><a id="__codelineno-39-134" name="__codelineno-39-134" href="#__codelineno-39-134"></a><span class="w">    </span>const<span class="w"> </span><span class="kt">tx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>CrossChainReceiverContract<span class="p">.</span>setRegisteredSender<span class="p">(</span>
</span><span id="__span-39-135"><a id="__codelineno-39-135" name="__codelineno-39-135" href="#__codelineno-39-135"></a><span class="w">      </span>sourceChain<span class="p">.</span>chainId<span class="p">,</span>
</span><span id="__span-39-136"><a id="__codelineno-39-136" name="__codelineno-39-136" href="#__codelineno-39-136"></a><span class="w">      </span>ethers<span class="p">.</span>zeroPadValue<span class="p">(</span>senderAddress<span class="w"> </span>as<span class="w"> </span>BytesLike<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="p">)</span>
</span><span id="__span-39-137"><a id="__codelineno-39-137" name="__codelineno-39-137" href="#__codelineno-39-137"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-138"><a id="__codelineno-39-138" name="__codelineno-39-138" href="#__codelineno-39-138"></a>
</span><span id="__span-39-139"><a id="__codelineno-39-139" name="__codelineno-39-139" href="#__codelineno-39-139"></a><span class="w">    </span>await<span class="w"> </span><span class="k">tx.wait</span><span class="p">();</span>
</span><span id="__span-39-140"><a id="__codelineno-39-140" name="__codelineno-39-140" href="#__codelineno-39-140"></a><span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span>
</span><span id="__span-39-141"><a id="__codelineno-39-141" name="__codelineno-39-141" href="#__codelineno-39-141"></a><span class="w">      </span><span class="err">`</span>CrossChainSender<span class="w"> </span>registered<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>valid<span class="w"> </span>sender<span class="w"> </span>on<span class="w"> </span><span class="err">$</span><span class="p">{</span>targetChain<span class="p">.</span>description<span class="p">}</span><span class="err">`</span>
</span><span id="__span-39-142"><a id="__codelineno-39-142" name="__codelineno-39-142" href="#__codelineno-39-142"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-143"><a id="__codelineno-39-143" name="__codelineno-39-143" href="#__codelineno-39-143"></a>
</span><span id="__span-39-144"><a id="__codelineno-39-144" name="__codelineno-39-144" href="#__codelineno-39-144"></a><span class="w">    </span><span class="c1">// Load existing deployed contract addresses from contracts.json</span>
</span><span id="__span-39-145"><a id="__codelineno-39-145" name="__codelineno-39-145" href="#__codelineno-39-145"></a><span class="w">    </span>const<span class="w"> </span>deployedContractsPath<span class="w"> </span><span class="o">=</span><span class="w"> </span>path<span class="p">.</span>resolve<span class="p">(</span>
</span><span id="__span-39-146"><a id="__codelineno-39-146" name="__codelineno-39-146" href="#__codelineno-39-146"></a><span class="w">      </span>__dirname<span class="p">,</span>
</span><span id="__span-39-147"><a id="__codelineno-39-147" name="__codelineno-39-147" href="#__codelineno-39-147"></a><span class="w">      </span><span class="s1">&#39;../deploy-config/contracts.json&#39;</span>
</span><span id="__span-39-148"><a id="__codelineno-39-148" name="__codelineno-39-148" href="#__codelineno-39-148"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-149"><a id="__codelineno-39-149" name="__codelineno-39-149" href="#__codelineno-39-149"></a><span class="w">    </span>let<span class="w"> </span>deployedContracts<span class="o">:</span><span class="w"> </span>DeployedContracts<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-39-150"><a id="__codelineno-39-150" name="__codelineno-39-150" href="#__codelineno-39-150"></a>
</span><span id="__span-39-151"><a id="__codelineno-39-151" name="__codelineno-39-151" href="#__codelineno-39-151"></a><span class="w">    </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>fs<span class="p">.</span>existsSync<span class="p">(</span>deployedContractsPath<span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-152"><a id="__codelineno-39-152" name="__codelineno-39-152" href="#__codelineno-39-152"></a><span class="w">      </span>deployedContracts<span class="w"> </span><span class="o">=</span><span class="w"> </span>JSON<span class="p">.</span>parse<span class="p">(</span>
</span><span id="__span-39-153"><a id="__codelineno-39-153" name="__codelineno-39-153" href="#__codelineno-39-153"></a><span class="w">        </span>fs<span class="p">.</span>readFileSync<span class="p">(</span>deployedContractsPath<span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span><span id="__span-39-154"><a id="__codelineno-39-154" name="__codelineno-39-154" href="#__codelineno-39-154"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-39-155"><a id="__codelineno-39-155" name="__codelineno-39-155" href="#__codelineno-39-155"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-156"><a id="__codelineno-39-156" name="__codelineno-39-156" href="#__codelineno-39-156"></a>
</span><span id="__span-39-157"><a id="__codelineno-39-157" name="__codelineno-39-157" href="#__codelineno-39-157"></a><span class="w">    </span><span class="c1">// Update the contracts.json file:</span>
</span><span id="__span-39-158"><a id="__codelineno-39-158" name="__codelineno-39-158" href="#__codelineno-39-158"></a><span class="w">    </span><span class="c1">// If a contract already exists on a chain, update its address; otherwise, add a new entry.</span>
</span><span id="__span-39-159"><a id="__codelineno-39-159" name="__codelineno-39-159" href="#__codelineno-39-159"></a><span class="w">    </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>deployedContracts<span class="p">[</span>sourceChain<span class="p">.</span>chainId<span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-160"><a id="__codelineno-39-160" name="__codelineno-39-160" href="#__codelineno-39-160"></a><span class="w">      </span>deployedContracts<span class="p">[</span>sourceChain<span class="p">.</span>chainId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-161"><a id="__codelineno-39-161" name="__codelineno-39-161" href="#__codelineno-39-161"></a><span class="w">        </span>networkName<span class="o">:</span><span class="w"> </span>sourceChain<span class="p">.</span>description<span class="p">,</span>
</span><span id="__span-39-162"><a id="__codelineno-39-162" name="__codelineno-39-162" href="#__codelineno-39-162"></a><span class="w">        </span>deployedAt<span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Date<span class="p">().</span>toISOString<span class="p">(),</span>
</span><span id="__span-39-163"><a id="__codelineno-39-163" name="__codelineno-39-163" href="#__codelineno-39-163"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-39-164"><a id="__codelineno-39-164" name="__codelineno-39-164" href="#__codelineno-39-164"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-165"><a id="__codelineno-39-165" name="__codelineno-39-165" href="#__codelineno-39-165"></a><span class="w">    </span>deployedContracts<span class="p">[</span>sourceChain<span class="p">.</span>chainId<span class="p">].</span>CrossChainSender<span class="w"> </span><span class="o">=</span>
</span><span id="__span-39-166"><a id="__codelineno-39-166" name="__codelineno-39-166" href="#__codelineno-39-166"></a><span class="w">      </span>senderAddress<span class="p">.</span>toString<span class="p">();</span>
</span><span id="__span-39-167"><a id="__codelineno-39-167" name="__codelineno-39-167" href="#__codelineno-39-167"></a><span class="w">    </span>deployedContracts<span class="p">[</span>sourceChain<span class="p">.</span>chainId<span class="p">].</span>deployedAt<span class="w"> </span><span class="o">=</span>
</span><span id="__span-39-168"><a id="__codelineno-39-168" name="__codelineno-39-168" href="#__codelineno-39-168"></a><span class="w">      </span><span class="kt">new</span><span class="w"> </span>Date<span class="p">().</span>toISOString<span class="p">();</span>
</span><span id="__span-39-169"><a id="__codelineno-39-169" name="__codelineno-39-169" href="#__codelineno-39-169"></a>
</span><span id="__span-39-170"><a id="__codelineno-39-170" name="__codelineno-39-170" href="#__codelineno-39-170"></a><span class="w">    </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>deployedContracts<span class="p">[</span>targetChain<span class="p">.</span>chainId<span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-171"><a id="__codelineno-39-171" name="__codelineno-39-171" href="#__codelineno-39-171"></a><span class="w">      </span>deployedContracts<span class="p">[</span>targetChain<span class="p">.</span>chainId<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-172"><a id="__codelineno-39-172" name="__codelineno-39-172" href="#__codelineno-39-172"></a><span class="w">        </span>networkName<span class="o">:</span><span class="w"> </span>targetChain<span class="p">.</span>description<span class="p">,</span>
</span><span id="__span-39-173"><a id="__codelineno-39-173" name="__codelineno-39-173" href="#__codelineno-39-173"></a><span class="w">        </span>deployedAt<span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>Date<span class="p">().</span>toISOString<span class="p">(),</span>
</span><span id="__span-39-174"><a id="__codelineno-39-174" name="__codelineno-39-174" href="#__codelineno-39-174"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-39-175"><a id="__codelineno-39-175" name="__codelineno-39-175" href="#__codelineno-39-175"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-176"><a id="__codelineno-39-176" name="__codelineno-39-176" href="#__codelineno-39-176"></a><span class="w">    </span>deployedContracts<span class="p">[</span>targetChain<span class="p">.</span>chainId<span class="p">].</span>CrossChainReceiver<span class="w"> </span><span class="o">=</span>
</span><span id="__span-39-177"><a id="__codelineno-39-177" name="__codelineno-39-177" href="#__codelineno-39-177"></a><span class="w">      </span>receiverAddress<span class="p">.</span>toString<span class="p">();</span>
</span><span id="__span-39-178"><a id="__codelineno-39-178" name="__codelineno-39-178" href="#__codelineno-39-178"></a><span class="w">    </span>deployedContracts<span class="p">[</span>targetChain<span class="p">.</span>chainId<span class="p">].</span>deployedAt<span class="w"> </span><span class="o">=</span>
</span><span id="__span-39-179"><a id="__codelineno-39-179" name="__codelineno-39-179" href="#__codelineno-39-179"></a><span class="w">      </span><span class="kt">new</span><span class="w"> </span>Date<span class="p">().</span>toISOString<span class="p">();</span>
</span><span id="__span-39-180"><a id="__codelineno-39-180" name="__codelineno-39-180" href="#__codelineno-39-180"></a>
</span><span id="__span-39-181"><a id="__codelineno-39-181" name="__codelineno-39-181" href="#__codelineno-39-181"></a><span class="w">    </span><span class="c1">// Save the updated contracts.json file</span>
</span><span id="__span-39-182"><a id="__codelineno-39-182" name="__codelineno-39-182" href="#__codelineno-39-182"></a><span class="w">    </span>fs<span class="p">.</span>writeFileSync<span class="p">(</span>
</span><span id="__span-39-183"><a id="__codelineno-39-183" name="__codelineno-39-183" href="#__codelineno-39-183"></a><span class="w">      </span>deployedContractsPath<span class="p">,</span>
</span><span id="__span-39-184"><a id="__codelineno-39-184" name="__codelineno-39-184" href="#__codelineno-39-184"></a><span class="w">      </span>JSON<span class="p">.</span>stringify<span class="p">(</span>deployedContracts<span class="p">,</span><span class="w"> </span>null<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">)</span>
</span><span id="__span-39-185"><a id="__codelineno-39-185" name="__codelineno-39-185" href="#__codelineno-39-185"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-39-186"><a id="__codelineno-39-186" name="__codelineno-39-186" href="#__codelineno-39-186"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span>catch<span class="w"> </span><span class="p">(</span>error<span class="o">:</span><span class="w"> </span>any<span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-187"><a id="__codelineno-39-187" name="__codelineno-39-187" href="#__codelineno-39-187"></a><span class="w">    </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>error<span class="p">.</span>code<span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;INSUFFICIENT_FUNDS&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-188"><a id="__codelineno-39-188" name="__codelineno-39-188" href="#__codelineno-39-188"></a><span class="w">      </span>console<span class="p">.</span>error<span class="p">(</span>
</span><span id="__span-39-189"><a id="__codelineno-39-189" name="__codelineno-39-189" href="#__codelineno-39-189"></a><span class="w">        </span><span class="s1">&#39;Error: Insufficient funds for deployment. Please make sure your wallet has enough funds to cover the gas fees.&#39;</span>
</span><span id="__span-39-190"><a id="__codelineno-39-190" name="__codelineno-39-190" href="#__codelineno-39-190"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-39-191"><a id="__codelineno-39-191" name="__codelineno-39-191" href="#__codelineno-39-191"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-192"><a id="__codelineno-39-192" name="__codelineno-39-192" href="#__codelineno-39-192"></a><span class="w">      </span>console<span class="p">.</span>error<span class="p">(</span><span class="s1">&#39;An unexpected error occurred:&#39;</span><span class="p">,</span><span class="w"> </span>error<span class="p">.</span>message<span class="p">);</span>
</span><span id="__span-39-193"><a id="__codelineno-39-193" name="__codelineno-39-193" href="#__codelineno-39-193"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-194"><a id="__codelineno-39-194" name="__codelineno-39-194" href="#__codelineno-39-194"></a><span class="w">    </span>process<span class="p">.</span>exit<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">);</span>
</span><span id="__span-39-195"><a id="__codelineno-39-195" name="__codelineno-39-195" href="#__codelineno-39-195"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-39-196"><a id="__codelineno-39-196" name="__codelineno-39-196" href="#__codelineno-39-196"></a><span class="p">}</span>
</span><span id="__span-39-197"><a id="__codelineno-39-197" name="__codelineno-39-197" href="#__codelineno-39-197"></a>
</span><span id="__span-39-198"><a id="__codelineno-39-198" name="__codelineno-39-198" href="#__codelineno-39-198"></a>main<span class="p">().</span>catch<span class="p">((</span>error<span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-199"><a id="__codelineno-39-199" name="__codelineno-39-199" href="#__codelineno-39-199"></a><span class="w">  </span>console<span class="p">.</span>error<span class="p">(</span>error<span class="p">);</span>
</span><span id="__span-39-200"><a id="__codelineno-39-200" name="__codelineno-39-200" href="#__codelineno-39-200"></a><span class="w">  </span>process<span class="p">.</span>exit<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">);</span>
</span><span id="__span-39-201"><a id="__codelineno-39-201" name="__codelineno-39-201" href="#__codelineno-39-201"></a><span class="p">});</span>
</span></code></pre></div>
</details>
</li>
<li>
<p><strong>Add your private key</strong> - you'll need to provide your private key. It allows your deployment script to sign the transactions that deploy the smart contracts to the blockchain. Without it, the script won't be able to interact with the blockchain on your behalf</p>
<p>Create a <code>.env</code> file in the root of the project and add your private key:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>touch<span class="w"> </span>.env
</span></code></pre></div>
<p>Inside <code>.env</code>, add your private key in the following format:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>PRIVATE_KEY=INSERT_PRIVATE_KEY
</span></code></pre></div>
</li>
<li>
<p><strong>Run the deployment script</strong></p>
<ol>
<li>
<p>Open a terminal and run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>npx<span class="w"> </span>ts-node<span class="w"> </span>script/deploy.ts
</span></code></pre></div>
<p>This will execute the deployment script, deploying both contracts to the selected chains.</p>
</li>
<li>
<p>Check the deployment output:</p>
<ul>
<li>You will see the deployed contract addresses printed in the terminal if successful. The <code>contracts.json</code> file will be updated with these addresses</li>
<li>If you encounter an error, the script will provide feedback, such as insufficient funds for gas</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>If you followed the logic provided in the full code above, your terminal output should look something like this:</p>
<div id="termynal" data-termynal>
    <span data-ty="input"><span class="file-path"></span>npx ts-node deploy.ts</span>
    <span data-ty> > cross-chain-token-transfer@1.0.0 deploy</span>
    <span data-ty> > npx ts-node script/deploy.ts</span>
    <span data-ty> Select the SOURCE chain:</span>
    <span data-ty> 1: Avalanche testnet fuji</span>
  <span data-ty> 2: Celo Testnet</span>
  <span data-ty> </span>
  <span data-ty> Enter the number for the SOURCE chain: 1</span>
  <span data-ty> </span>
  <span data-ty> Select the TARGET chain:</span>
  <span data-ty> 1: Avalanche testnet fuji</span>
  <span data-ty> 2: Celo Testnet</span>
  <span data-ty> </span>
  <span data-ty> Enter the number for the TARGET chain: 2</span>
  <span data-ty> CrossChainSender Avalanche testnet fuji: 0x1Cac52a183D02F9002fdb37b13eC2fAB950d44E3</span>
  <span data-ty> CrossChainReceiver Celo Testnet: 0xD720BFF42a0960cfF1118454A907a44dB358f2b1</span>
  <span data-ty> </span>
  <span data-ty> Registering CrossChainSender (0x1Cac52a183D02F9002fdb37b13eC2fAB950d44E3) as a valid sender in CrossChainReceiver (0xD720BFF42a0960cfF1118454A907a44dB358f2b1)...</span>
  <span data-ty> </span>
  <span data-ty> CrossChainSender registered as a valid sender on Celo Testnet</span>
    <span data-ty="input"><span class="file-path"></span></span>
</div>

<h2 id="transfer-tokens-across-chains">Transfer Tokens Across Chains</h2>
<h3 id="quick-recap">Quick Recap</h3>
<p>Up to this point, you've set up a new Solidity project using Foundry, developed two key contracts (<code>CrossChainSender</code> and <code>CrossChainReceiver</code>), and created a deployment script to deploy these contracts to different blockchain networks. The deployment script also saves the new contract addresses for easy reference. With everything in place, it's time to transfer tokens using the deployed contracts.</p>
<p>In this step, you'll write a script to transfer tokens across chains using the <code>CrossChainSender</code> and <code>CrossChainReceiver</code> contracts you deployed earlier. This script will interact with the contracts and facilitate the cross-chain token transfer.</p>
<h3 id="transfer-script">Transfer Script</h3>
<ol>
<li>
<p><strong>Set up the transfer script</strong></p>
<ol>
<li>
<p>Create a new file named <code>transfer.ts</code> in the <code>/script</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>touch<span class="w"> </span>script/transfer.ts
</span></code></pre></div>
</li>
<li>
<p>Open the file. Start with the necessary imports, interfaces and configurations:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ethers</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ethers&#39;</span><span class="p">;</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">dotenv</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;dotenv&#39;</span><span class="p">;</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="k">import</span><span class="w"> </span><span class="nx">readlineSync</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;readline-sync&#39;</span><span class="p">;</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="nx">dotenv</span><span class="p">.</span><span class="nx">config</span><span class="p">();</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">ChainConfig</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">  </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">  </span><span class="nx">rpc</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">  </span><span class="nx">tokenBridge</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">  </span><span class="nx">wormholeRelayer</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">  </span><span class="nx">wormhole</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="p">}</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">DeployedContracts</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="w">  </span><span class="p">[</span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="w">    </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="w">    </span><span class="nx">CrossChainSender?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a><span class="w">    </span><span class="nx">CrossChainReceiver?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="w">    </span><span class="nx">deployedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a><span class="p">}</span>
</span></code></pre></div>
<p>These imports include the essential libraries for interacting with Ethereum, handling file paths, loading environment variables, and managing user input.</p>
</li>
<li>
<p>Load configuration and contracts:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">loadConfig</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ChainConfig</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">configPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;../deploy-config/config.json&#39;</span><span class="p">);</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">configPath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">)).</span><span class="nx">chains</span><span class="p">;</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="p">}</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="kd">function</span><span class="w"> </span><span class="nx">loadDeployedContracts</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">DeployedContracts</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">contractsPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">    </span><span class="nx">__dirname</span><span class="p">,</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">    </span><span class="s1">&#39;../deploy-config/contracts.json&#39;</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">    </span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">contractsPath</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">contractsPath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">      </span><span class="s1">&#39;No contracts found. Please deploy contracts first before transferring tokens.&#39;</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">contractsPath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">));</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>These functions load the network and contract details that were saved during deployment.</p>
</li>
<li>
<p>Allow users to select source and target chains:</p>
<p>Refer to the deployed contracts and create logic as desired. In our example, we made this process interactive, allowing users to select the source and target chains from all the historically deployed contracts. This interactive approach helps ensure the correct chains are selected for the token transfer.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">selectSourceChain</span><span class="p">(</span><span class="nx">deployedContracts</span><span class="o">:</span><span class="w"> </span><span class="kt">DeployedContracts</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">  </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">  </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="p">}</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">deployedContracts</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">    </span><span class="p">([,</span><span class="w"> </span><span class="nx">contracts</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">contracts</span><span class="p">.</span><span class="nx">CrossChainSender</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceOptions</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;No source chains available with CrossChainSender deployed.&#39;</span><span class="p">);</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nSelect the source chain:&#39;</span><span class="p">);</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">  </span><span class="nx">sourceOptions</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(([</span><span class="nx">chainId</span><span class="p">,</span><span class="w"> </span><span class="nx">contracts</span><span class="p">],</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">networkName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a><span class="w">    </span><span class="nx">readlineSync</span><span class="p">.</span><span class="nx">questionInt</span><span class="p">(</span><span class="sb">`\nEnter the number for the source chain: `</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="w">    </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">Number</span><span class="p">(</span><span class="nx">sourceOptions</span><span class="p">[</span><span class="nx">selectedIndex</span><span class="p">][</span><span class="mf">0</span><span class="p">]),</span>
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a><span class="w">    </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">sourceOptions</span><span class="p">[</span><span class="nx">selectedIndex</span><span class="p">][</span><span class="mf">1</span><span class="p">].</span><span class="nx">networkName</span><span class="p">,</span>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="p">}</span>
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a>
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="kd">function</span><span class="w"> </span><span class="nx">selectTargetChain</span><span class="p">(</span><span class="nx">deployedContracts</span><span class="o">:</span><span class="w"> </span><span class="kt">DeployedContracts</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a><span class="w">  </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="w">  </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a><span class="p">}</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">deployedContracts</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span>
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="w">    </span><span class="p">([,</span><span class="w"> </span><span class="nx">contracts</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">contracts</span><span class="p">.</span><span class="nx">CrossChainReceiver</span>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a>
</span><span id="__span-46-35"><a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">targetOptions</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-36"><a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
</span><span id="__span-46-37"><a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a><span class="w">      </span><span class="s1">&#39;No target chains available with CrossChainReceiver deployed.&#39;</span>
</span><span id="__span-46-38"><a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-46-39"><a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-46-40"><a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-41"><a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a>
</span><span id="__span-46-42"><a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nSelect the target chain:&#39;</span><span class="p">);</span>
</span><span id="__span-46-43"><a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a><span class="w">  </span><span class="nx">targetOptions</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(([</span><span class="nx">chainId</span><span class="p">,</span><span class="w"> </span><span class="nx">contracts</span><span class="p">],</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-44"><a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">networkName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-46-45"><a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-46-46"><a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a>
</span><span id="__span-46-47"><a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-46-48"><a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a><span class="w">    </span><span class="nx">readlineSync</span><span class="p">.</span><span class="nx">questionInt</span><span class="p">(</span><span class="sb">`\nEnter the number for the target chain: `</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-46-49"><a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-50"><a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a><span class="w">    </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">Number</span><span class="p">(</span><span class="nx">targetOptions</span><span class="p">[</span><span class="nx">selectedIndex</span><span class="p">][</span><span class="mf">0</span><span class="p">]),</span>
</span><span id="__span-46-51"><a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a><span class="w">    </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">targetOptions</span><span class="p">[</span><span class="nx">selectedIndex</span><span class="p">][</span><span class="mf">1</span><span class="p">].</span><span class="nx">networkName</span><span class="p">,</span>
</span><span id="__span-46-52"><a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-46-53"><a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ol>
</li>
<li>
<p><strong>Implement the token transfer logic</strong></p>
<ol>
<li>
<p>Start the <code>main</code> function:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">chains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loadConfig</span><span class="p">();</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">deployedContracts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loadDeployedContracts</span><span class="p">();</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">  </span><span class="c1">// Select the source chain (only show chains with CrossChainSender deployed)</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">sourceChainId</span><span class="p">,</span><span class="w"> </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">sourceNetworkName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">    </span><span class="nx">selectSourceChain</span><span class="p">(</span><span class="nx">deployedContracts</span><span class="p">);</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">chains</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">chain</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">chain</span><span class="p">.</span><span class="nx">chainId</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">sourceChainId</span><span class="p">)</span><span class="o">!</span><span class="p">;</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w">  </span><span class="c1">// Select the target chain (only show chains with CrossChainReceiver deployed)</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">chainId</span><span class="o">:</span><span class="w"> </span><span class="kt">targetChainId</span><span class="p">,</span><span class="w"> </span><span class="nx">networkName</span><span class="o">:</span><span class="w"> </span><span class="kt">targetNetworkName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">    </span><span class="nx">selectTargetChain</span><span class="p">(</span><span class="nx">deployedContracts</span><span class="p">);</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">chains</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">chain</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">chain</span><span class="p">.</span><span class="nx">chainId</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">targetChainId</span><span class="p">)</span><span class="o">!</span><span class="p">;</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">  </span><span class="c1">// Set up providers and wallets</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">JsonRpcProvider</span><span class="p">(</span><span class="nx">sourceChain</span><span class="p">.</span><span class="nx">rpc</span><span class="p">);</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">wallet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Wallet</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PRIVATE_KEY</span><span class="o">!</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceProvider</span><span class="p">);</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="w">  </span><span class="c1">// Load the ABI from the JSON file (use the compiled ABI from Forge or Hardhat)</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">CrossChainSenderArtifact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="w">      </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="w">        </span><span class="nx">__dirname</span><span class="p">,</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a><span class="w">        </span><span class="s1">&#39;../out/CrossChainSender.sol/CrossChainSender.json&#39;</span>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a><span class="w">      </span><span class="p">),</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a><span class="w">      </span><span class="s1">&#39;utf8&#39;</span>
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a>
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">abi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CrossChainSenderArtifact</span><span class="p">.</span><span class="nx">abi</span><span class="p">;</span>
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a>
</span><span id="__span-47-32"><a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a><span class="w">  </span><span class="c1">// Create the contract instance using the full ABI</span>
</span><span id="__span-47-33"><a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">CrossChainSender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span>
</span><span id="__span-47-34"><a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a><span class="w">    </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">sourceChainId</span><span class="p">].</span><span class="nx">CrossChainSender</span><span class="o">!</span><span class="p">,</span>
</span><span id="__span-47-35"><a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a><span class="w">    </span><span class="nx">abi</span><span class="p">,</span>
</span><span id="__span-47-36"><a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a><span class="w">    </span><span class="nx">wallet</span>
</span><span id="__span-47-37"><a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a><span class="w">  </span><span class="p">);</span>
</span></code></pre></div>
<p>The <code>main</code> function is where the token transfer logic will reside. It loads the chain and contract details, sets up the wallet and provider, and loads the <code>CrossChainSender</code> contract.</p>
</li>
<li>
<p>Ask the user for token transfer details:</p>
<p>You'll now ask the user for the token contract address, the recipient address on the target chain, and the amount of tokens to transfer.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">readlineSync</span><span class="p">.</span><span class="nx">question</span><span class="p">(</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="s1">&#39;Enter the token contract address: &#39;</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">recipientAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">readlineSync</span><span class="p">.</span><span class="nx">question</span><span class="p">(</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="s1">&#39;Enter the recipient address on the target chain: &#39;</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">  </span><span class="c1">// Get the token contract</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenContractDecimals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">    </span><span class="nx">tokenAddress</span><span class="p">,</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">    </span><span class="p">[</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">      </span><span class="s1">&#39;function decimals() view returns (uint8)&#39;</span><span class="p">,</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">      </span><span class="s1">&#39;function approve(address spender, uint256 amount) public returns (bool)&#39;</span><span class="p">,</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="nx">wallet</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="w">  </span><span class="c1">// Fetch the token decimals</span>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">decimals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">tokenContractDecimals</span><span class="p">.</span><span class="nx">decimals</span><span class="p">();</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a><span class="w">  </span><span class="c1">// Get the amount from the user, then parse it according to the token&#39;s decimals</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">parseUnits</span><span class="p">(</span>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a><span class="w">    </span><span class="nx">readlineSync</span><span class="p">.</span><span class="nx">question</span><span class="p">(</span><span class="s1">&#39;Enter the amount of tokens to transfer: &#39;</span><span class="p">),</span>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a><span class="w">    </span><span class="nx">decimals</span>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a><span class="w">  </span><span class="p">);</span>
</span></code></pre></div>
<p>This section of the script prompts the user for the token contract address and the recipient's address, fetches the token's decimal value, and parses the amount accordingly.</p>
</li>
<li>
<p>Initiate the transfer:</p>
<p>Finally, initiate the cross-chain transfer and log the details.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">CrossChainSender</span><span class="p">.</span><span class="nx">quoteCrossChainDeposit</span><span class="p">(</span><span class="nx">targetChainId</span><span class="p">);</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">  </span><span class="c1">// Approve the CrossChainSender contract to transfer tokens on behalf of the user</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ethers</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">    </span><span class="nx">tokenAddress</span><span class="p">,</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="p">[</span><span class="s1">&#39;function approve(address spender, uint256 amount) public returns (bool)&#39;</span><span class="p">],</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">    </span><span class="nx">wallet</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">approveTx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">tokenContract</span><span class="p">.</span><span class="nx">approve</span><span class="p">(</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">    </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">sourceChainId</span><span class="p">].</span><span class="nx">CrossChainSender</span><span class="o">!</span><span class="p">,</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">    </span><span class="nx">amount</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">approveTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Approved tokens for cross-chain transfer.`</span><span class="p">);</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="w">  </span><span class="c1">// Initiate the cross-chain transfer</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">transferTx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">CrossChainSender</span><span class="p">.</span><span class="nx">sendCrossChainDeposit</span><span class="p">(</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">    </span><span class="nx">targetChainId</span><span class="p">,</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="w">    </span><span class="nx">deployedContracts</span><span class="p">[</span><span class="nx">targetChainId</span><span class="p">].</span><span class="nx">CrossChainReceiver</span><span class="o">!</span><span class="p">,</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="w">    </span><span class="nx">recipientAddress</span><span class="p">,</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="w">    </span><span class="nx">amount</span><span class="p">,</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a><span class="w">    </span><span class="nx">tokenAddress</span><span class="p">,</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">cost</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Attach the necessary fee for cross-chain transfer</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">transferTx</span><span class="p">.</span><span class="nx">wait</span><span class="p">();</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a><span class="w">    </span><span class="sb">`Transfer initiated from </span><span class="si">${</span><span class="nx">sourceNetworkName</span><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><span class="nx">targetNetworkName</span><span class="si">}</span><span class="sb">. Transaction Hash: </span><span class="si">${</span><span class="nx">transferTx</span><span class="p">.</span><span class="nx">hash</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a><span class="p">}</span>
</span></code></pre></div>
<p>This part of the script first approves the token transfer, then initiates the cross-chain transfer using the <code>CrossChainSender</code> contract, and finally logs the transaction hash for the user to track.</p>
</li>
<li>
<p>Finalize the script:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="p">});</span>
</span></code></pre></div>
<p>This section finalizes the script by calling the <code>main</code> function and handling any errors that may occur during the token transfer process.</p>
</li>
</ol>
</li>
</ol>
<p>You can find the full code for the <code>transfer.ts</code> file below:</p>
<details class="code">
<summary>transfer.ts</summary>
<div class="language-solidity highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kt">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>ethers<span class="w"> </span><span class="p">}</span><span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;ethers&#39;</span><span class="p">;</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="kt">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>as<span class="w"> </span>fs<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="kt">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>as<span class="w"> </span>path<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="kt">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>as<span class="w"> </span>dotenv<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;dotenv&#39;</span><span class="p">;</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="kt">import</span><span class="w"> </span>readlineSync<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;readline-sync&#39;</span><span class="p">;</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>dotenv<span class="p">.</span>config<span class="p">();</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>interface<span class="w"> </span>ChainConfig<span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">  </span>description<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">  </span>chainId<span class="o">:</span><span class="w"> </span>number<span class="p">;</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">  </span>rpc<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">  </span>tokenBridge<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">  </span>wormholeRelayer<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">  </span>wormhole<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="p">}</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>interface<span class="w"> </span>DeployedContracts<span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">  </span><span class="p">[</span>chainId<span class="o">:</span><span class="w"> </span>number<span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">    </span>networkName<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">    </span>CrossChainSender<span class="o">?:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">    </span>CrossChainReceiver<span class="o">?:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="w">    </span>deployedAt<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="p">}</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="kt">function</span><span class="w"> </span><span class="nv">loadConfig</span><span class="p">()</span><span class="o">:</span><span class="w"> </span>ChainConfig<span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="w">  </span>const<span class="w"> </span>configPath<span class="w"> </span><span class="o">=</span><span class="w"> </span>path<span class="p">.</span>resolve<span class="p">(</span>__dirname<span class="p">,</span><span class="w"> </span><span class="s1">&#39;../deploy-config/config.json&#39;</span><span class="p">);</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">  </span><span class="kt">return</span><span class="w"> </span>JSON<span class="p">.</span>parse<span class="p">(</span>fs<span class="p">.</span>readFileSync<span class="p">(</span>configPath<span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">)).</span>chains<span class="p">;</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="p">}</span>
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a>
</span><span id="__span-51-32"><a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a><span class="kt">function</span><span class="w"> </span><span class="nv">loadDeployedContracts</span><span class="p">()</span><span class="o">:</span><span class="w"> </span>DeployedContracts<span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-33"><a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="w">  </span>const<span class="w"> </span>contractsPath<span class="w"> </span><span class="o">=</span><span class="w"> </span>path<span class="p">.</span>resolve<span class="p">(</span>
</span><span id="__span-51-34"><a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="w">    </span>__dirname<span class="p">,</span>
</span><span id="__span-51-35"><a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="w">    </span><span class="s1">&#39;../deploy-config/contracts.json&#39;</span>
</span><span id="__span-51-36"><a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-37"><a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="w">  </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-51-38"><a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="w">    </span><span class="o">!</span>fs<span class="p">.</span>existsSync<span class="p">(</span>contractsPath<span class="p">)</span><span class="w"> </span><span class="o">||</span>
</span><span id="__span-51-39"><a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a><span class="w">    </span>fs<span class="p">.</span>readFileSync<span class="p">(</span>contractsPath<span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">).</span>trim<span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
</span><span id="__span-51-40"><a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-41"><a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a><span class="w">    </span>console<span class="p">.</span>error<span class="p">(</span>
</span><span id="__span-51-42"><a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a><span class="w">      </span><span class="s1">&#39;No contracts found. Please deploy contracts first before transferring tokens.&#39;</span>
</span><span id="__span-51-43"><a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-51-44"><a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a><span class="w">    </span>process<span class="p">.</span>exit<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">);</span>
</span><span id="__span-51-45"><a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-51-46"><a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a><span class="w">  </span><span class="kt">return</span><span class="w"> </span>JSON<span class="p">.</span>parse<span class="p">(</span>fs<span class="p">.</span>readFileSync<span class="p">(</span>contractsPath<span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">));</span>
</span><span id="__span-51-47"><a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a><span class="p">}</span>
</span><span id="__span-51-48"><a id="__codelineno-51-48" name="__codelineno-51-48" href="#__codelineno-51-48"></a>
</span><span id="__span-51-49"><a id="__codelineno-51-49" name="__codelineno-51-49" href="#__codelineno-51-49"></a><span class="kt">function</span><span class="w"> </span><span class="nv">selectSourceChain</span><span class="p">(</span>deployedContracts<span class="o">:</span><span class="w"> </span>DeployedContracts<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-50"><a id="__codelineno-51-50" name="__codelineno-51-50" href="#__codelineno-51-50"></a><span class="w">  </span>chainId<span class="o">:</span><span class="w"> </span>number<span class="p">;</span>
</span><span id="__span-51-51"><a id="__codelineno-51-51" name="__codelineno-51-51" href="#__codelineno-51-51"></a><span class="w">  </span>networkName<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-52"><a id="__codelineno-51-52" name="__codelineno-51-52" href="#__codelineno-51-52"></a><span class="p">}</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-53"><a id="__codelineno-51-53" name="__codelineno-51-53" href="#__codelineno-51-53"></a><span class="w">  </span>const<span class="w"> </span>sourceOptions<span class="w"> </span><span class="o">=</span><span class="w"> </span>Object<span class="p">.</span>entries<span class="p">(</span>deployedContracts<span class="p">).</span>filter<span class="p">(</span>
</span><span id="__span-51-54"><a id="__codelineno-51-54" name="__codelineno-51-54" href="#__codelineno-51-54"></a><span class="w">    </span><span class="p">([,</span><span class="w"> </span>contracts<span class="p">])</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>contracts<span class="p">.</span>CrossChainSender
</span><span id="__span-51-55"><a id="__codelineno-51-55" name="__codelineno-51-55" href="#__codelineno-51-55"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-56"><a id="__codelineno-51-56" name="__codelineno-51-56" href="#__codelineno-51-56"></a>
</span><span id="__span-51-57"><a id="__codelineno-51-57" name="__codelineno-51-57" href="#__codelineno-51-57"></a><span class="w">  </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>sourceOptions<span class="p">.</span>length<span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-58"><a id="__codelineno-51-58" name="__codelineno-51-58" href="#__codelineno-51-58"></a><span class="w">    </span>console<span class="p">.</span>error<span class="p">(</span><span class="s1">&#39;No source chains available with CrossChainSender deployed.&#39;</span><span class="p">);</span>
</span><span id="__span-51-59"><a id="__codelineno-51-59" name="__codelineno-51-59" href="#__codelineno-51-59"></a><span class="w">    </span>process<span class="p">.</span>exit<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">);</span>
</span><span id="__span-51-60"><a id="__codelineno-51-60" name="__codelineno-51-60" href="#__codelineno-51-60"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-51-61"><a id="__codelineno-51-61" name="__codelineno-51-61" href="#__codelineno-51-61"></a>
</span><span id="__span-51-62"><a id="__codelineno-51-62" name="__codelineno-51-62" href="#__codelineno-51-62"></a><span class="w">  </span>console<span class="p">.</span>log<span class="p">(</span><span class="s1">&#39;\nSelect the source chain:&#39;</span><span class="p">);</span>
</span><span id="__span-51-63"><a id="__codelineno-51-63" name="__codelineno-51-63" href="#__codelineno-51-63"></a><span class="w">  </span>sourceOptions<span class="p">.</span>forEach<span class="p">(([</span>chainId<span class="p">,</span><span class="w"> </span>contracts<span class="p">],</span><span class="w"> </span>index<span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-64"><a id="__codelineno-51-64" name="__codelineno-51-64" href="#__codelineno-51-64"></a><span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span><span class="err">`$</span><span class="p">{</span>index<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">{</span>contracts<span class="p">.</span>networkName<span class="p">}</span><span class="err">`</span><span class="p">);</span>
</span><span id="__span-51-65"><a id="__codelineno-51-65" name="__codelineno-51-65" href="#__codelineno-51-65"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-51-66"><a id="__codelineno-51-66" name="__codelineno-51-66" href="#__codelineno-51-66"></a>
</span><span id="__span-51-67"><a id="__codelineno-51-67" name="__codelineno-51-67" href="#__codelineno-51-67"></a><span class="w">  </span>const<span class="w"> </span>selectedIndex<span class="w"> </span><span class="o">=</span>
</span><span id="__span-51-68"><a id="__codelineno-51-68" name="__codelineno-51-68" href="#__codelineno-51-68"></a><span class="w">    </span>readlineSync<span class="p">.</span>questionInt<span class="p">(</span><span class="err">`\</span>nEnter<span class="w"> </span>the<span class="w"> </span>number<span class="w"> </span><span class="kt">for</span><span class="w"> </span>the<span class="w"> </span>source<span class="w"> </span>chain<span class="o">:</span><span class="w"> </span><span class="err">`</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
</span><span id="__span-51-69"><a id="__codelineno-51-69" name="__codelineno-51-69" href="#__codelineno-51-69"></a><span class="w">  </span><span class="kt">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-70"><a id="__codelineno-51-70" name="__codelineno-51-70" href="#__codelineno-51-70"></a><span class="w">    </span>chainId<span class="o">:</span><span class="w"> </span>Number<span class="p">(</span>sourceOptions<span class="p">[</span>selectedIndex<span class="p">][</span><span class="m m-Decimal">0</span><span class="p">]),</span>
</span><span id="__span-51-71"><a id="__codelineno-51-71" name="__codelineno-51-71" href="#__codelineno-51-71"></a><span class="w">    </span>networkName<span class="o">:</span><span class="w"> </span>sourceOptions<span class="p">[</span>selectedIndex<span class="p">][</span><span class="m m-Decimal">1</span><span class="p">].</span>networkName<span class="p">,</span>
</span><span id="__span-51-72"><a id="__codelineno-51-72" name="__codelineno-51-72" href="#__codelineno-51-72"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-51-73"><a id="__codelineno-51-73" name="__codelineno-51-73" href="#__codelineno-51-73"></a><span class="p">}</span>
</span><span id="__span-51-74"><a id="__codelineno-51-74" name="__codelineno-51-74" href="#__codelineno-51-74"></a>
</span><span id="__span-51-75"><a id="__codelineno-51-75" name="__codelineno-51-75" href="#__codelineno-51-75"></a><span class="kt">function</span><span class="w"> </span><span class="nv">selectTargetChain</span><span class="p">(</span>deployedContracts<span class="o">:</span><span class="w"> </span>DeployedContracts<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-76"><a id="__codelineno-51-76" name="__codelineno-51-76" href="#__codelineno-51-76"></a><span class="w">  </span>chainId<span class="o">:</span><span class="w"> </span>number<span class="p">;</span>
</span><span id="__span-51-77"><a id="__codelineno-51-77" name="__codelineno-51-77" href="#__codelineno-51-77"></a><span class="w">  </span>networkName<span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-51-78"><a id="__codelineno-51-78" name="__codelineno-51-78" href="#__codelineno-51-78"></a><span class="p">}</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-79"><a id="__codelineno-51-79" name="__codelineno-51-79" href="#__codelineno-51-79"></a><span class="w">  </span>const<span class="w"> </span>targetOptions<span class="w"> </span><span class="o">=</span><span class="w"> </span>Object<span class="p">.</span>entries<span class="p">(</span>deployedContracts<span class="p">).</span>filter<span class="p">(</span>
</span><span id="__span-51-80"><a id="__codelineno-51-80" name="__codelineno-51-80" href="#__codelineno-51-80"></a><span class="w">    </span><span class="p">([,</span><span class="w"> </span>contracts<span class="p">])</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>contracts<span class="p">.</span>CrossChainReceiver
</span><span id="__span-51-81"><a id="__codelineno-51-81" name="__codelineno-51-81" href="#__codelineno-51-81"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-82"><a id="__codelineno-51-82" name="__codelineno-51-82" href="#__codelineno-51-82"></a>
</span><span id="__span-51-83"><a id="__codelineno-51-83" name="__codelineno-51-83" href="#__codelineno-51-83"></a><span class="w">  </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>targetOptions<span class="p">.</span>length<span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-84"><a id="__codelineno-51-84" name="__codelineno-51-84" href="#__codelineno-51-84"></a><span class="w">    </span>console<span class="p">.</span>error<span class="p">(</span>
</span><span id="__span-51-85"><a id="__codelineno-51-85" name="__codelineno-51-85" href="#__codelineno-51-85"></a><span class="w">      </span><span class="s1">&#39;No target chains available with CrossChainReceiver deployed.&#39;</span>
</span><span id="__span-51-86"><a id="__codelineno-51-86" name="__codelineno-51-86" href="#__codelineno-51-86"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-51-87"><a id="__codelineno-51-87" name="__codelineno-51-87" href="#__codelineno-51-87"></a><span class="w">    </span>process<span class="p">.</span>exit<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">);</span>
</span><span id="__span-51-88"><a id="__codelineno-51-88" name="__codelineno-51-88" href="#__codelineno-51-88"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-51-89"><a id="__codelineno-51-89" name="__codelineno-51-89" href="#__codelineno-51-89"></a>
</span><span id="__span-51-90"><a id="__codelineno-51-90" name="__codelineno-51-90" href="#__codelineno-51-90"></a><span class="w">  </span>console<span class="p">.</span>log<span class="p">(</span><span class="s1">&#39;\nSelect the target chain:&#39;</span><span class="p">);</span>
</span><span id="__span-51-91"><a id="__codelineno-51-91" name="__codelineno-51-91" href="#__codelineno-51-91"></a><span class="w">  </span>targetOptions<span class="p">.</span>forEach<span class="p">(([</span>chainId<span class="p">,</span><span class="w"> </span>contracts<span class="p">],</span><span class="w"> </span>index<span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-92"><a id="__codelineno-51-92" name="__codelineno-51-92" href="#__codelineno-51-92"></a><span class="w">    </span>console<span class="p">.</span>log<span class="p">(</span><span class="err">`$</span><span class="p">{</span>index<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">{</span>contracts<span class="p">.</span>networkName<span class="p">}</span><span class="err">`</span><span class="p">);</span>
</span><span id="__span-51-93"><a id="__codelineno-51-93" name="__codelineno-51-93" href="#__codelineno-51-93"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-51-94"><a id="__codelineno-51-94" name="__codelineno-51-94" href="#__codelineno-51-94"></a>
</span><span id="__span-51-95"><a id="__codelineno-51-95" name="__codelineno-51-95" href="#__codelineno-51-95"></a><span class="w">  </span>const<span class="w"> </span>selectedIndex<span class="w"> </span><span class="o">=</span>
</span><span id="__span-51-96"><a id="__codelineno-51-96" name="__codelineno-51-96" href="#__codelineno-51-96"></a><span class="w">    </span>readlineSync<span class="p">.</span>questionInt<span class="p">(</span><span class="err">`\</span>nEnter<span class="w"> </span>the<span class="w"> </span>number<span class="w"> </span><span class="kt">for</span><span class="w"> </span>the<span class="w"> </span>target<span class="w"> </span>chain<span class="o">:</span><span class="w"> </span><span class="err">`</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span>
</span><span id="__span-51-97"><a id="__codelineno-51-97" name="__codelineno-51-97" href="#__codelineno-51-97"></a><span class="w">  </span><span class="kt">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-98"><a id="__codelineno-51-98" name="__codelineno-51-98" href="#__codelineno-51-98"></a><span class="w">    </span>chainId<span class="o">:</span><span class="w"> </span>Number<span class="p">(</span>targetOptions<span class="p">[</span>selectedIndex<span class="p">][</span><span class="m m-Decimal">0</span><span class="p">]),</span>
</span><span id="__span-51-99"><a id="__codelineno-51-99" name="__codelineno-51-99" href="#__codelineno-51-99"></a><span class="w">    </span>networkName<span class="o">:</span><span class="w"> </span>targetOptions<span class="p">[</span>selectedIndex<span class="p">][</span><span class="m m-Decimal">1</span><span class="p">].</span>networkName<span class="p">,</span>
</span><span id="__span-51-100"><a id="__codelineno-51-100" name="__codelineno-51-100" href="#__codelineno-51-100"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-51-101"><a id="__codelineno-51-101" name="__codelineno-51-101" href="#__codelineno-51-101"></a><span class="p">}</span>
</span><span id="__span-51-102"><a id="__codelineno-51-102" name="__codelineno-51-102" href="#__codelineno-51-102"></a>
</span><span id="__span-51-103"><a id="__codelineno-51-103" name="__codelineno-51-103" href="#__codelineno-51-103"></a>async<span class="w"> </span><span class="kt">function</span><span class="w"> </span><span class="nv">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-104"><a id="__codelineno-51-104" name="__codelineno-51-104" href="#__codelineno-51-104"></a><span class="w">  </span>const<span class="w"> </span>chains<span class="w"> </span><span class="o">=</span><span class="w"> </span>loadConfig<span class="p">();</span>
</span><span id="__span-51-105"><a id="__codelineno-51-105" name="__codelineno-51-105" href="#__codelineno-51-105"></a><span class="w">  </span>const<span class="w"> </span>deployedContracts<span class="w"> </span><span class="o">=</span><span class="w"> </span>loadDeployedContracts<span class="p">();</span>
</span><span id="__span-51-106"><a id="__codelineno-51-106" name="__codelineno-51-106" href="#__codelineno-51-106"></a>
</span><span id="__span-51-107"><a id="__codelineno-51-107" name="__codelineno-51-107" href="#__codelineno-51-107"></a><span class="w">  </span><span class="c1">// Select the source chain (only show chains with CrossChainSender deployed)</span>
</span><span id="__span-51-108"><a id="__codelineno-51-108" name="__codelineno-51-108" href="#__codelineno-51-108"></a><span class="w">  </span>const<span class="w"> </span><span class="p">{</span><span class="w"> </span>chainId<span class="o">:</span><span class="w"> </span>sourceChainId<span class="p">,</span><span class="w"> </span>networkName<span class="o">:</span><span class="w"> </span>sourceNetworkName<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-51-109"><a id="__codelineno-51-109" name="__codelineno-51-109" href="#__codelineno-51-109"></a><span class="w">    </span>selectSourceChain<span class="p">(</span>deployedContracts<span class="p">);</span>
</span><span id="__span-51-110"><a id="__codelineno-51-110" name="__codelineno-51-110" href="#__codelineno-51-110"></a><span class="w">  </span>const<span class="w"> </span>sourceChain<span class="w"> </span><span class="o">=</span><span class="w"> </span>chains<span class="p">.</span>find<span class="p">((</span>chain<span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>chain<span class="p">.</span>chainId<span class="w"> </span><span class="o">===</span><span class="w"> </span>sourceChainId<span class="p">)</span><span class="o">!</span><span class="p">;</span>
</span><span id="__span-51-111"><a id="__codelineno-51-111" name="__codelineno-51-111" href="#__codelineno-51-111"></a>
</span><span id="__span-51-112"><a id="__codelineno-51-112" name="__codelineno-51-112" href="#__codelineno-51-112"></a><span class="w">  </span><span class="c1">// Select the target chain (only show chains with CrossChainReceiver deployed)</span>
</span><span id="__span-51-113"><a id="__codelineno-51-113" name="__codelineno-51-113" href="#__codelineno-51-113"></a><span class="w">  </span>const<span class="w"> </span><span class="p">{</span><span class="w"> </span>chainId<span class="o">:</span><span class="w"> </span>targetChainId<span class="p">,</span><span class="w"> </span>networkName<span class="o">:</span><span class="w"> </span>targetNetworkName<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-51-114"><a id="__codelineno-51-114" name="__codelineno-51-114" href="#__codelineno-51-114"></a><span class="w">    </span>selectTargetChain<span class="p">(</span>deployedContracts<span class="p">);</span>
</span><span id="__span-51-115"><a id="__codelineno-51-115" name="__codelineno-51-115" href="#__codelineno-51-115"></a><span class="w">  </span>const<span class="w"> </span>targetChain<span class="w"> </span><span class="o">=</span><span class="w"> </span>chains<span class="p">.</span>find<span class="p">((</span>chain<span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>chain<span class="p">.</span>chainId<span class="w"> </span><span class="o">===</span><span class="w"> </span>targetChainId<span class="p">)</span><span class="o">!</span><span class="p">;</span>
</span><span id="__span-51-116"><a id="__codelineno-51-116" name="__codelineno-51-116" href="#__codelineno-51-116"></a>
</span><span id="__span-51-117"><a id="__codelineno-51-117" name="__codelineno-51-117" href="#__codelineno-51-117"></a><span class="w">  </span><span class="c1">// Set up providers and wallets</span>
</span><span id="__span-51-118"><a id="__codelineno-51-118" name="__codelineno-51-118" href="#__codelineno-51-118"></a><span class="w">  </span>const<span class="w"> </span>sourceProvider<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>JsonRpcProvider<span class="p">(</span>sourceChain<span class="p">.</span>rpc<span class="p">);</span>
</span><span id="__span-51-119"><a id="__codelineno-51-119" name="__codelineno-51-119" href="#__codelineno-51-119"></a><span class="w">  </span>const<span class="w"> </span>wallet<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>Wallet<span class="p">(</span>process<span class="p">.</span>env<span class="p">.</span>PRIVATE_KEY<span class="o">!</span><span class="p">,</span><span class="w"> </span>sourceProvider<span class="p">);</span>
</span><span id="__span-51-120"><a id="__codelineno-51-120" name="__codelineno-51-120" href="#__codelineno-51-120"></a>
</span><span id="__span-51-121"><a id="__codelineno-51-121" name="__codelineno-51-121" href="#__codelineno-51-121"></a><span class="w">  </span><span class="c1">// Load the ABI from the JSON file (use the compiled ABI from Forge or Hardhat)</span>
</span><span id="__span-51-122"><a id="__codelineno-51-122" name="__codelineno-51-122" href="#__codelineno-51-122"></a><span class="w">  </span>const<span class="w"> </span>CrossChainSenderArtifact<span class="w"> </span><span class="o">=</span><span class="w"> </span>JSON<span class="p">.</span>parse<span class="p">(</span>
</span><span id="__span-51-123"><a id="__codelineno-51-123" name="__codelineno-51-123" href="#__codelineno-51-123"></a><span class="w">    </span>fs<span class="p">.</span>readFileSync<span class="p">(</span>
</span><span id="__span-51-124"><a id="__codelineno-51-124" name="__codelineno-51-124" href="#__codelineno-51-124"></a><span class="w">      </span>path<span class="p">.</span>resolve<span class="p">(</span>
</span><span id="__span-51-125"><a id="__codelineno-51-125" name="__codelineno-51-125" href="#__codelineno-51-125"></a><span class="w">        </span>__dirname<span class="p">,</span>
</span><span id="__span-51-126"><a id="__codelineno-51-126" name="__codelineno-51-126" href="#__codelineno-51-126"></a><span class="w">        </span><span class="s1">&#39;../out/CrossChainSender.sol/CrossChainSender.json&#39;</span>
</span><span id="__span-51-127"><a id="__codelineno-51-127" name="__codelineno-51-127" href="#__codelineno-51-127"></a><span class="w">      </span><span class="p">),</span>
</span><span id="__span-51-128"><a id="__codelineno-51-128" name="__codelineno-51-128" href="#__codelineno-51-128"></a><span class="w">      </span><span class="s1">&#39;utf8&#39;</span>
</span><span id="__span-51-129"><a id="__codelineno-51-129" name="__codelineno-51-129" href="#__codelineno-51-129"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-51-130"><a id="__codelineno-51-130" name="__codelineno-51-130" href="#__codelineno-51-130"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-131"><a id="__codelineno-51-131" name="__codelineno-51-131" href="#__codelineno-51-131"></a>
</span><span id="__span-51-132"><a id="__codelineno-51-132" name="__codelineno-51-132" href="#__codelineno-51-132"></a><span class="w">  </span>const<span class="w"> </span>abi<span class="w"> </span><span class="o">=</span><span class="w"> </span>CrossChainSenderArtifact<span class="p">.</span>abi<span class="p">;</span>
</span><span id="__span-51-133"><a id="__codelineno-51-133" name="__codelineno-51-133" href="#__codelineno-51-133"></a>
</span><span id="__span-51-134"><a id="__codelineno-51-134" name="__codelineno-51-134" href="#__codelineno-51-134"></a><span class="w">  </span><span class="c1">// Create the contract instance using the full ABI</span>
</span><span id="__span-51-135"><a id="__codelineno-51-135" name="__codelineno-51-135" href="#__codelineno-51-135"></a><span class="w">  </span>const<span class="w"> </span>CrossChainSender<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>Contract<span class="p">(</span>
</span><span id="__span-51-136"><a id="__codelineno-51-136" name="__codelineno-51-136" href="#__codelineno-51-136"></a><span class="w">    </span>deployedContracts<span class="p">[</span>sourceChainId<span class="p">].</span>CrossChainSender<span class="o">!</span><span class="p">,</span>
</span><span id="__span-51-137"><a id="__codelineno-51-137" name="__codelineno-51-137" href="#__codelineno-51-137"></a><span class="w">    </span>abi<span class="p">,</span>
</span><span id="__span-51-138"><a id="__codelineno-51-138" name="__codelineno-51-138" href="#__codelineno-51-138"></a><span class="w">    </span>wallet
</span><span id="__span-51-139"><a id="__codelineno-51-139" name="__codelineno-51-139" href="#__codelineno-51-139"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-140"><a id="__codelineno-51-140" name="__codelineno-51-140" href="#__codelineno-51-140"></a>
</span><span id="__span-51-141"><a id="__codelineno-51-141" name="__codelineno-51-141" href="#__codelineno-51-141"></a><span class="w">  </span><span class="c1">// Display the selected chains</span>
</span><span id="__span-51-142"><a id="__codelineno-51-142" name="__codelineno-51-142" href="#__codelineno-51-142"></a><span class="w">  </span>console<span class="p">.</span>log<span class="p">(</span>
</span><span id="__span-51-143"><a id="__codelineno-51-143" name="__codelineno-51-143" href="#__codelineno-51-143"></a><span class="w">    </span><span class="err">`\</span>nInitiating<span class="w"> </span>transfer<span class="w"> </span>from<span class="w"> </span><span class="err">$</span><span class="p">{</span>sourceNetworkName<span class="p">}</span><span class="w"> </span>to<span class="w"> </span><span class="err">$</span><span class="p">{</span>targetNetworkName<span class="p">}.</span><span class="err">`</span>
</span><span id="__span-51-144"><a id="__codelineno-51-144" name="__codelineno-51-144" href="#__codelineno-51-144"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-145"><a id="__codelineno-51-145" name="__codelineno-51-145" href="#__codelineno-51-145"></a>
</span><span id="__span-51-146"><a id="__codelineno-51-146" name="__codelineno-51-146" href="#__codelineno-51-146"></a><span class="w">  </span><span class="c1">// Ask the user for token transfer details</span>
</span><span id="__span-51-147"><a id="__codelineno-51-147" name="__codelineno-51-147" href="#__codelineno-51-147"></a><span class="w">  </span>const<span class="w"> </span>tokenAddress<span class="w"> </span><span class="o">=</span><span class="w"> </span>readlineSync<span class="p">.</span>question<span class="p">(</span>
</span><span id="__span-51-148"><a id="__codelineno-51-148" name="__codelineno-51-148" href="#__codelineno-51-148"></a><span class="w">    </span><span class="s1">&#39;Enter the token contract address: &#39;</span>
</span><span id="__span-51-149"><a id="__codelineno-51-149" name="__codelineno-51-149" href="#__codelineno-51-149"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-150"><a id="__codelineno-51-150" name="__codelineno-51-150" href="#__codelineno-51-150"></a><span class="w">  </span>const<span class="w"> </span>recipientAddress<span class="w"> </span><span class="o">=</span><span class="w"> </span>readlineSync<span class="p">.</span>question<span class="p">(</span>
</span><span id="__span-51-151"><a id="__codelineno-51-151" name="__codelineno-51-151" href="#__codelineno-51-151"></a><span class="w">    </span><span class="s1">&#39;Enter the recipient address on the target chain: &#39;</span>
</span><span id="__span-51-152"><a id="__codelineno-51-152" name="__codelineno-51-152" href="#__codelineno-51-152"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-153"><a id="__codelineno-51-153" name="__codelineno-51-153" href="#__codelineno-51-153"></a>
</span><span id="__span-51-154"><a id="__codelineno-51-154" name="__codelineno-51-154" href="#__codelineno-51-154"></a><span class="w">  </span><span class="c1">// Get the token contract</span>
</span><span id="__span-51-155"><a id="__codelineno-51-155" name="__codelineno-51-155" href="#__codelineno-51-155"></a><span class="w">  </span>const<span class="w"> </span>tokenContractDecimals<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>Contract<span class="p">(</span>
</span><span id="__span-51-156"><a id="__codelineno-51-156" name="__codelineno-51-156" href="#__codelineno-51-156"></a><span class="w">    </span>tokenAddress<span class="p">,</span>
</span><span id="__span-51-157"><a id="__codelineno-51-157" name="__codelineno-51-157" href="#__codelineno-51-157"></a><span class="w">    </span><span class="p">[</span>
</span><span id="__span-51-158"><a id="__codelineno-51-158" name="__codelineno-51-158" href="#__codelineno-51-158"></a><span class="w">      </span><span class="s1">&#39;function decimals() view returns (uint8)&#39;</span><span class="p">,</span>
</span><span id="__span-51-159"><a id="__codelineno-51-159" name="__codelineno-51-159" href="#__codelineno-51-159"></a><span class="w">      </span><span class="s1">&#39;function approve(address spender, uint256 amount) public returns (bool)&#39;</span><span class="p">,</span>
</span><span id="__span-51-160"><a id="__codelineno-51-160" name="__codelineno-51-160" href="#__codelineno-51-160"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-51-161"><a id="__codelineno-51-161" name="__codelineno-51-161" href="#__codelineno-51-161"></a><span class="w">    </span>wallet
</span><span id="__span-51-162"><a id="__codelineno-51-162" name="__codelineno-51-162" href="#__codelineno-51-162"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-163"><a id="__codelineno-51-163" name="__codelineno-51-163" href="#__codelineno-51-163"></a>
</span><span id="__span-51-164"><a id="__codelineno-51-164" name="__codelineno-51-164" href="#__codelineno-51-164"></a><span class="w">  </span><span class="c1">// Fetch the token decimals</span>
</span><span id="__span-51-165"><a id="__codelineno-51-165" name="__codelineno-51-165" href="#__codelineno-51-165"></a><span class="w">  </span>const<span class="w"> </span>decimals<span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>tokenContractDecimals<span class="p">.</span>decimals<span class="p">();</span>
</span><span id="__span-51-166"><a id="__codelineno-51-166" name="__codelineno-51-166" href="#__codelineno-51-166"></a>
</span><span id="__span-51-167"><a id="__codelineno-51-167" name="__codelineno-51-167" href="#__codelineno-51-167"></a><span class="w">  </span><span class="c1">// Get the amount from the user, then parse it according to the token&#39;s decimals</span>
</span><span id="__span-51-168"><a id="__codelineno-51-168" name="__codelineno-51-168" href="#__codelineno-51-168"></a><span class="w">  </span>const<span class="w"> </span>amount<span class="w"> </span><span class="o">=</span><span class="w"> </span>ethers<span class="p">.</span>parseUnits<span class="p">(</span>
</span><span id="__span-51-169"><a id="__codelineno-51-169" name="__codelineno-51-169" href="#__codelineno-51-169"></a><span class="w">    </span>readlineSync<span class="p">.</span>question<span class="p">(</span><span class="s1">&#39;Enter the amount of tokens to transfer: &#39;</span><span class="p">),</span>
</span><span id="__span-51-170"><a id="__codelineno-51-170" name="__codelineno-51-170" href="#__codelineno-51-170"></a><span class="w">    </span>decimals
</span><span id="__span-51-171"><a id="__codelineno-51-171" name="__codelineno-51-171" href="#__codelineno-51-171"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-172"><a id="__codelineno-51-172" name="__codelineno-51-172" href="#__codelineno-51-172"></a>
</span><span id="__span-51-173"><a id="__codelineno-51-173" name="__codelineno-51-173" href="#__codelineno-51-173"></a><span class="w">  </span><span class="c1">// Calculate the cross-chain transfer cost</span>
</span><span id="__span-51-174"><a id="__codelineno-51-174" name="__codelineno-51-174" href="#__codelineno-51-174"></a><span class="w">  </span>const<span class="w"> </span>cost<span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>CrossChainSender<span class="p">.</span>quoteCrossChainDeposit<span class="p">(</span>targetChainId<span class="p">);</span>
</span><span id="__span-51-175"><a id="__codelineno-51-175" name="__codelineno-51-175" href="#__codelineno-51-175"></a>
</span><span id="__span-51-176"><a id="__codelineno-51-176" name="__codelineno-51-176" href="#__codelineno-51-176"></a><span class="w">  </span><span class="c1">// Approve the CrossChainSender contract to transfer tokens on behalf of the user</span>
</span><span id="__span-51-177"><a id="__codelineno-51-177" name="__codelineno-51-177" href="#__codelineno-51-177"></a><span class="w">  </span>const<span class="w"> </span>tokenContract<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>ethers<span class="p">.</span>Contract<span class="p">(</span>
</span><span id="__span-51-178"><a id="__codelineno-51-178" name="__codelineno-51-178" href="#__codelineno-51-178"></a><span class="w">    </span>tokenAddress<span class="p">,</span>
</span><span id="__span-51-179"><a id="__codelineno-51-179" name="__codelineno-51-179" href="#__codelineno-51-179"></a><span class="w">    </span><span class="p">[</span><span class="s1">&#39;function approve(address spender, uint256 amount) public returns (bool)&#39;</span><span class="p">],</span>
</span><span id="__span-51-180"><a id="__codelineno-51-180" name="__codelineno-51-180" href="#__codelineno-51-180"></a><span class="w">    </span>wallet
</span><span id="__span-51-181"><a id="__codelineno-51-181" name="__codelineno-51-181" href="#__codelineno-51-181"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-182"><a id="__codelineno-51-182" name="__codelineno-51-182" href="#__codelineno-51-182"></a>
</span><span id="__span-51-183"><a id="__codelineno-51-183" name="__codelineno-51-183" href="#__codelineno-51-183"></a><span class="w">  </span>const<span class="w"> </span>approveTx<span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>tokenContract<span class="p">.</span>approve<span class="p">(</span>
</span><span id="__span-51-184"><a id="__codelineno-51-184" name="__codelineno-51-184" href="#__codelineno-51-184"></a><span class="w">    </span>deployedContracts<span class="p">[</span>sourceChainId<span class="p">].</span>CrossChainSender<span class="o">!</span><span class="p">,</span>
</span><span id="__span-51-185"><a id="__codelineno-51-185" name="__codelineno-51-185" href="#__codelineno-51-185"></a><span class="w">    </span>amount
</span><span id="__span-51-186"><a id="__codelineno-51-186" name="__codelineno-51-186" href="#__codelineno-51-186"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-187"><a id="__codelineno-51-187" name="__codelineno-51-187" href="#__codelineno-51-187"></a><span class="w">  </span>await<span class="w"> </span>approveTx<span class="p">.</span>wait<span class="p">();</span>
</span><span id="__span-51-188"><a id="__codelineno-51-188" name="__codelineno-51-188" href="#__codelineno-51-188"></a><span class="w">  </span>console<span class="p">.</span>log<span class="p">(</span><span class="err">`</span>Approved<span class="w"> </span>tokens<span class="w"> </span><span class="kt">for</span><span class="w"> </span>cross<span class="o">-</span>chain<span class="w"> </span>transfer<span class="p">.</span><span class="err">`</span><span class="p">);</span>
</span><span id="__span-51-189"><a id="__codelineno-51-189" name="__codelineno-51-189" href="#__codelineno-51-189"></a>
</span><span id="__span-51-190"><a id="__codelineno-51-190" name="__codelineno-51-190" href="#__codelineno-51-190"></a><span class="w">  </span><span class="c1">// Initiate the cross-chain transfer</span>
</span><span id="__span-51-191"><a id="__codelineno-51-191" name="__codelineno-51-191" href="#__codelineno-51-191"></a><span class="w">  </span>const<span class="w"> </span>transferTx<span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>CrossChainSender<span class="p">.</span>sendCrossChainDeposit<span class="p">(</span>
</span><span id="__span-51-192"><a id="__codelineno-51-192" name="__codelineno-51-192" href="#__codelineno-51-192"></a><span class="w">    </span>targetChainId<span class="p">,</span>
</span><span id="__span-51-193"><a id="__codelineno-51-193" name="__codelineno-51-193" href="#__codelineno-51-193"></a><span class="w">    </span>deployedContracts<span class="p">[</span>targetChainId<span class="p">].</span>CrossChainReceiver<span class="o">!</span><span class="p">,</span>
</span><span id="__span-51-194"><a id="__codelineno-51-194" name="__codelineno-51-194" href="#__codelineno-51-194"></a><span class="w">    </span>recipientAddress<span class="p">,</span>
</span><span id="__span-51-195"><a id="__codelineno-51-195" name="__codelineno-51-195" href="#__codelineno-51-195"></a><span class="w">    </span>amount<span class="p">,</span>
</span><span id="__span-51-196"><a id="__codelineno-51-196" name="__codelineno-51-196" href="#__codelineno-51-196"></a><span class="w">    </span>tokenAddress<span class="p">,</span>
</span><span id="__span-51-197"><a id="__codelineno-51-197" name="__codelineno-51-197" href="#__codelineno-51-197"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span>value<span class="o">:</span><span class="w"> </span>cost<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Attach the necessary fee for cross-chain transfer</span>
</span><span id="__span-51-198"><a id="__codelineno-51-198" name="__codelineno-51-198" href="#__codelineno-51-198"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-199"><a id="__codelineno-51-199" name="__codelineno-51-199" href="#__codelineno-51-199"></a><span class="w">  </span>await<span class="w"> </span>transferTx<span class="p">.</span>wait<span class="p">();</span>
</span><span id="__span-51-200"><a id="__codelineno-51-200" name="__codelineno-51-200" href="#__codelineno-51-200"></a><span class="w">  </span>console<span class="p">.</span>log<span class="p">(</span>
</span><span id="__span-51-201"><a id="__codelineno-51-201" name="__codelineno-51-201" href="#__codelineno-51-201"></a><span class="w">    </span><span class="err">`</span>Transfer<span class="w"> </span>initiated<span class="w"> </span>from<span class="w"> </span><span class="err">$</span><span class="p">{</span>sourceNetworkName<span class="p">}</span><span class="w"> </span>to<span class="w"> </span><span class="err">$</span><span class="p">{</span>targetNetworkName<span class="p">}.</span><span class="w"> </span>Transaction<span class="w"> </span>Hash<span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">{</span>transferTx<span class="p">.</span><span class="kt">hash</span><span class="p">}</span><span class="err">`</span>
</span><span id="__span-51-202"><a id="__codelineno-51-202" name="__codelineno-51-202" href="#__codelineno-51-202"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-51-203"><a id="__codelineno-51-203" name="__codelineno-51-203" href="#__codelineno-51-203"></a><span class="p">}</span>
</span><span id="__span-51-204"><a id="__codelineno-51-204" name="__codelineno-51-204" href="#__codelineno-51-204"></a>
</span><span id="__span-51-205"><a id="__codelineno-51-205" name="__codelineno-51-205" href="#__codelineno-51-205"></a>main<span class="p">().</span>catch<span class="p">((</span>error<span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-206"><a id="__codelineno-51-206" name="__codelineno-51-206" href="#__codelineno-51-206"></a><span class="w">  </span>console<span class="p">.</span>error<span class="p">(</span>error<span class="p">);</span>
</span><span id="__span-51-207"><a id="__codelineno-51-207" name="__codelineno-51-207" href="#__codelineno-51-207"></a><span class="w">  </span>process<span class="p">.</span>exit<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">);</span>
</span><span id="__span-51-208"><a id="__codelineno-51-208" name="__codelineno-51-208" href="#__codelineno-51-208"></a><span class="p">});</span>
</span></code></pre></div>
</details>
<h3 id="transfer-tokens">Transfer Tokens</h3>
<p>Now that your transfer script is ready, it’s time to execute it and perform a cross-chain token transfer.</p>
<ol>
<li>
<p><strong>Run the transfer script</strong></p>
<p>Open your terminal and run the transfer script:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>npx<span class="w"> </span>ts-node<span class="w"> </span>script/transfer.ts
</span></code></pre></div>
<p>This command will start the script, prompting you to select the source and target chains, input the token address, recipient address, and the amount of tokens to transfer.</p>
</li>
<li>
<p><strong>Follow the prompts</strong> - the script will guide you through selecting the source and target chains and entering the necessary details for the token transfer. Once you provide all the required information, the script will initiate the token transfer</p>
</li>
<li>
<p><strong>Verify the transaction</strong> - after running the script, you should see a confirmation message with the transaction hash. You can use this transaction hash to check the transfer status on the respective blockchain explorers</p>
</li>
</ol>
<p>You can verify the transaction on the <a href="https://wormholescan.io/" target="_balnk">Wormhole Explorer</a> using the link provided in the terminal output. This explorer also offers the option to add the transferred token to your MetaMask wallet automatically.</p>
<p>If you followed the logic provided in the <code>transfer.ts</code> file above, your terminal output should look something like this:</p>
<div id="termynal" data-termynal>
    <span data-ty="input"><span class="file-path"></span>npx ts-node transfer.ts</span>
    <span data-ty> > cross-chain-token-transfer@1.0.0 transfer</span>
    <span data-ty> > npx ts-node script/transfer.ts</span>
  <span data-ty> </span>
    <span data-ty> Select the source chain:</span>
    <span data-ty> 1: Avalanche testnet fuji</span>
  <span data-ty> 2: Celo Testnet</span>
  <span data-ty> </span>
  <span data-ty> Enter the number for the SOURCE chain: 1</span>
  <span data-ty> </span>
  <span data-ty> Select the target chain:</span>
  <span data-ty> 1: Avalanche testnet fuji</span>
  <span data-ty> 2: Celo Testnet</span>
  <span data-ty> </span>
  <span data-ty> Enter the number for the TARGET chain: 2</span>
  <span data-ty> </span>
  <span data-ty> Initiating transfer from Avalanche testnet fuji to Celo Testnet</span>
  <span data-ty> Enter the token contract address: 0x5425890298aed601595a70ab815c96711a31bc65</span>
  <span data-ty> Enter the recipient address on the target chain: INSERT_YOUR_WALLET_ADDRESS</span>
  <span data-ty> Enter the amount of tokens to transfer: 2</span>
  <span data-ty> Approved tokens for cross-chain transfer.</span>
  <span data-ty> Transfer initiated from Avalanche testnet fuji to Celo Testnet. Transaction Hash: 0x4a923975d955c1f226a1c2f61a1a0fa1ab1a9e229dc29ceaeadf8ef40acd071f</span>
    <span data-ty="input"><span class="file-path"></span></span>
</div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example, we demonstrated a token transfer from the Avalanche Fuji TestNet to the Celo Alfajores TestNet. We sent two units of USDC TestNet tokens using the token contract address <code>0x5425890298aed601595a70ab815c96711a31bc65</code>. You can replace these details with those relevant to your project or use the same for testing purposes.</p>
</div>
<h2 id="resources">Resources</h2>
<p>If you'd like to explore the complete project or need a reference while following this tutorial, you can find the complete codebase in the <a href="https://github.com/martin0995/cross-chain-token-transfers" target="_blank">Cross-Chain Token Transfers GitHub repository</a>. The repository includes all the scripts, contracts, and configurations needed to deploy and transfer tokens across chains using the Wormhole protocol.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Congratulations! You've successfully built and deployed a cross-chain token transfer system using Solidity and the Wormhole protocol. You've learned how to:</p>
<ul>
<li>Set up a new Solidity project using Foundry</li>
<li>Develop smart contracts to send and receive tokens across chains</li>
<li>Write deployment scripts to manage and deploy contracts on different networks</li>
</ul>
<div class="md-source-file">
  <small>
    
  </small>
</div>

  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by submitting <a href="https://github.com/wormhole-foundation/wormhole-docs/issues/new/?title=[Feedback]+Cross-Chain%20Token%20Transfers+-+/tutorials/messaging/cross-chain-token-contracts/" target="_blank" rel="noopener">additional feedback</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


      
    </article>
  </div>
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        
  <footer class="md-footer">
    
    <nav class="md-footer__inner md-grid" aria-label="footer.title">
      
      <a href="../cross-chain-contracts/" class="md-footer__link md-footer__link--prev" rel="prev">
        <div class="md-footer__button md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.6 4.6L10.8 12l4.6-4.6L14 6l-6 6 6 6 1.4-1.4Z"/></svg>
        </div>
        <div class="md-footer__title">
          <span class="md-footer__direction">
            Previous
          </span>
          <span class="md-footer__page-name">
          Create Cross-Chain Contracts
          </span>
        </div>
      </a>
      
      
      <a href="../../../learn/" class="md-footer__link md-footer__link--next" rel="next">
        <div class="md-footer__title">
          <span class="md-footer__direction">
            Next
          </span>
          <span class="md-footer__page-name">
          Learn about Wormhole
          </span>
        </div>
        <div class="md-footer__button md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-12 6 6-6-6-6-1.4 1.4 4.6 4.6-4.6 4.6L10 18Z"/></svg>
        </div>
      </a>
      
    </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="column newsletter">
          <label for="email" class="newsletter-label">Subscribe for updates</label>
          <form action="https://formspree.io/f/{form_id}" method="post" class="md-footer-newsletter">
            <input name="Email" id="email" type="email" placeholder="Your email">
            <button type="submit">Subscribe</button>
          </form>
        </div>
        <div class="md-social">
  
    
    
    
    
    <a href="https://twitter.com/wormhole" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://discord.gg/wormholecrypto" target="_blank" rel="noopener" title="Discord" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://t.me/wormholecrypto" target="_blank" rel="noopener" title="Telegram" class="md-social__link">
      <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   width="22"
   height="22"
   fill="none"
   version="1.1"
   id="svg499"
   sodipodi:docname="telegram.svg"
   inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs503" />
  <sodipodi:namedview
     id="namedview501"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     showgrid="false"
     inkscape:zoom="10.727273"
     inkscape:cx="0.13983051"
     inkscape:cy="11"
     inkscape:window-width="1309"
     inkscape:window-height="430"
     inkscape:window-x="0"
     inkscape:window-y="25"
     inkscape:window-maximized="0"
     inkscape:current-layer="svg499" />
  <path
     fill="#fff"
     d="M18.984 3.35s1.78-.694 1.632.993c-.05.694-.494 3.124-.84 5.753l-1.188 7.787s-.099 1.14-.99 1.34c-.89.198-2.225-.695-2.472-.894-.198-.149-3.71-2.38-4.947-3.472-.346-.297-.742-.892.05-1.587l5.193-4.96c.594-.595 1.188-1.983-1.286-.297l-6.925 4.712s-.791.496-2.275.05l-3.216-.993s-1.187-.744.841-1.488c4.947-2.33 11.031-4.711 16.423-6.943Z"
     id="path497" />
</svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/wormhole-foundation/wormhole" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://docs.wormhole.com/" target="_blank" rel="noopener" title="Docs" class="md-social__link">
      <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   width="22"
   height="22"
   fill="none"
   version="1.1"
   id="svg191"
   sodipodi:docname="docs.svg"
   inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview193"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     showgrid="false"
     inkscape:zoom="6.8787622"
     inkscape:cx="-11.848062"
     inkscape:cy="9.4493745"
     inkscape:window-width="1309"
     inkscape:window-height="430"
     inkscape:window-x="0"
     inkscape:window-y="25"
     inkscape:window-maximized="0"
     inkscape:current-layer="svg191" />
  <g
     clipPath="url(#a)"
     id="g184">
    <path
       fill="#fff"
       d="M9.901 16.289a.644.644 0 1 1-.001 1.287.644.644 0 0 1 .001-1.287Zm10.106-3.985a.644.644 0 1 1 .001-1.289.644.644 0 0 1-.001 1.289Zm0-2.636a1.994 1.994 0 0 0-1.888 2.626l-6.582 3.504A1.984 1.984 0 0 0 9.9 14.94c-.76 0-1.452.436-1.787 1.115l-5.913-3.118c-.626-.329-1.093-1.357-1.044-2.294.026-.489.195-.868.452-1.015.163-.091.36-.084.569.025l.038.021c1.568.825 6.695 3.527 6.912 3.627.333.154.518.217 1.086-.053l10.6-5.513c.156-.058.338-.208.338-.434 0-.314-.325-.437-.326-.437-.603-.29-1.53-.723-2.433-1.146-1.933-.905-4.123-1.93-5.084-2.434-.83-.434-1.499-.068-1.618.006l-.231.114C7.13 5.543 1.338 8.413 1.008 8.613c-.59.36-.955 1.076-1.003 1.964-.073 1.409.645 2.878 1.672 3.416l6.254 3.225a1.994 1.994 0 0 0 1.97 1.707 1.996 1.996 0 0 0 1.992-1.962l6.888-3.733A1.99 1.99 0 0 0 22 11.66a1.995 1.995 0 0 0-1.993-1.993"
       id="path182" />
  </g>
  <defs
     id="defs189">
    <clipPath
       id="a">
      <path
         fill="#fff"
         d="M0 0h22v22H0z"
         id="path186" />
    </clipPath>
  </defs>
</svg>
    </a>
  
    
    
    
    
    <a href="https://www.youtube.com/@wormholecrypto" target="_blank" rel="noopener" title="YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      </div>
      <div class="md-footer-copyright md-grid">
        
        <div class="md-footer-copyright__highlight">
          2024 © Wormhole Foundation. All Rights Reserved.
        </div>
        
        <div class="papermoon">
          <span>Made with 🩵 by <a href="https://papermoon.io/" target="_blank">PaperMoon</a></span>
        </div>
        <div class="policy-links">
          <a href="https://wormhole.com/pages/terms-of-use" target="_blank">Terms of use</a>
          <a href="https://wormhole.com/pages/data-protection-and-privacy-policy" target="_blank">Privacy policy</a>
        </div>
      </div>
    </div>
  </footer>
  
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  





  

<h4>Cookie consent</h4>
<p>This site uses cookies to deliver its service and to analyze traffic. By browsing this site, you accept the <a href="https://wormhole.com/pages/data-protection-and-privacy-policy" target="_blank" rel="noopener">privacy policy</a>.</p>
<input class="md-toggle" type="checkbox" id="__settings" checked>
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>